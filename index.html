<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <title>op-geth</title>

    
<style>
    .term-container {
        background: #171717;
        border-radius: 5px;
        color: white;
        word-break: break-word;
        overflow-wrap: break-word;
        font-family: "SFMono-Regular", Monaco, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        font-size: 12px;
        line-height: 20px;
        padding: 14px 18px;
        white-space: pre-wrap;
    }

    .term-container img { max-width: 100%; }

    .term a { color: inherit; text-decoration: underline; text-decoration-style: dashed; }
    .term a:hover { color: #2882F9 }

    @keyframes blink-animation {
        to {
            visibility: hidden;
        }
    }

    .term-fg1 { } /* don't bold beccause it looks weird */
    .term-fg2 { color: #838887; } /* faint (decreased intensity) - same as gray really */
    .term-fg3 { font-style: italic; } /* italic */
    .term-fg4 { text-decoration: underline; } /* underline */
    .term-fg5 { animation: blink-animation 1s steps(3, start) infinite; } /* blink */
    .term-fg9 { text-decoration: line-through; } /* crossed-out */

    .term-fg30 { color: #666666; } /* black (but we can't use black, so a diff color) */
    .term-fg31 { color: #ff7070; } /* red */
    .term-fg32 { color: #b0f986; } /* green */
    .term-fg33 { color: #c6c502; } /* yellow */
    .term-fg34 { color: #8db7e0; } /* blue */
    .term-fg35 { color: #f271fb; } /* magenta */
    .term-fg36 { color: #6bf7ff; } /* cyan */

    /* high intense colors */
    .term-fgi1 { color: #5ef765; }
    .term-fgi90 { color: #838887; } /* grey */
    .term-fgi91 { color: #ff3333; } /* red */
    .term-fgi92 { color: #00FF00; } /* green */
    .term-fgi93 { color: #fffc67; } /* yellow */
    .term-fgi94 { color: #6871ff; } /* blue */
    .term-fgi95 { color: #ff76ff; } /* magenta */
    .term-fgi96 { color: #60fcff; } /* cyan */

    /* background colors */
    .term-bg40 { background: #676767; } /* grey */
    .term-bg41 { background: #ff4343; } /* red */
    .term-bg42 { background: #99ff5f; } /* green */

    /* custom foreground/background combos for readability */
    .term-fg31.term-bg40 { color: #F8A39F; }

    /* xterm colors */
    .term-fgx16 { color: #000000; }
    .term-fgx17 { color: #00005f; }
    .term-fgx18 { color: #000087; }
    .term-fgx19 { color: #0000af; }
    .term-fgx20 { color: #0000d7; }
    .term-fgx21 { color: #0000ff; }
    .term-fgx22 { color: #005f00; }
    .term-fgx23 { color: #005f5f; }
    .term-fgx24 { color: #005f87; }
    .term-fgx25 { color: #005faf; }
    .term-fgx26 { color: #005fd7; }
    .term-fgx27 { color: #005fff; }
    .term-fgx28 { color: #008700; }
    .term-fgx29 { color: #00875f; }
    .term-fgx30 { color: #008787; }
    .term-fgx31 { color: #0087af; }
    .term-fgx32 { color: #0087d7; }
    .term-fgx33 { color: #0087ff; }
    .term-fgx34 { color: #00af00; }
    .term-fgx35 { color: #00af5f; }
    .term-fgx36 { color: #00af87; }
    .term-fgx37 { color: #00afaf; }
    .term-fgx38 { color: #00afd7; }
    .term-fgx39 { color: #00afff; }
    .term-fgx40 { color: #00d700; }
    .term-fgx41 { color: #00d75f; }
    .term-fgx42 { color: #00d787; }
    .term-fgx43 { color: #00d7af; }
    .term-fgx44 { color: #00d7d7; }
    .term-fgx45 { color: #00d7ff; }
    .term-fgx46 { color: #00ff00; }
    .term-fgx47 { color: #00ff5f; }
    .term-fgx48 { color: #00ff87; }
    .term-fgx49 { color: #00ffaf; }
    .term-fgx50 { color: #00ffd7; }
    .term-fgx51 { color: #00ffff; }
    .term-fgx52 { color: #5f0000; }
    .term-fgx53 { color: #5f005f; }
    .term-fgx54 { color: #5f0087; }
    .term-fgx55 { color: #5f00af; }
    .term-fgx56 { color: #5f00d7; }
    .term-fgx57 { color: #5f00ff; }
    .term-fgx58 { color: #5f5f00; }
    .term-fgx59 { color: #5f5f5f; }
    .term-fgx60 { color: #5f5f87; }
    .term-fgx61 { color: #5f5faf; }
    .term-fgx62 { color: #5f5fd7; }
    .term-fgx63 { color: #5f5fff; }
    .term-fgx64 { color: #5f8700; }
    .term-fgx65 { color: #5f875f; }
    .term-fgx66 { color: #5f8787; }
    .term-fgx67 { color: #5f87af; }
    .term-fgx68 { color: #5f87d7; }
    .term-fgx69 { color: #5f87ff; }
    .term-fgx70 { color: #5faf00; }
    .term-fgx71 { color: #5faf5f; }
    .term-fgx72 { color: #5faf87; }
    .term-fgx73 { color: #5fafaf; }
    .term-fgx74 { color: #5fafd7; }
    .term-fgx75 { color: #5fafff; }
    .term-fgx76 { color: #5fd700; }
    .term-fgx77 { color: #5fd75f; }
    .term-fgx78 { color: #5fd787; }
    .term-fgx79 { color: #5fd7af; }
    .term-fgx80 { color: #5fd7d7; }
    .term-fgx81 { color: #5fd7ff; }
    .term-fgx82 { color: #5fff00; }
    .term-fgx83 { color: #5fff5f; }
    .term-fgx84 { color: #5fff87; }
    .term-fgx85 { color: #5fffaf; }
    .term-fgx86 { color: #5fffd7; }
    .term-fgx87 { color: #5fffff; }
    .term-fgx88 { color: #870000; }
    .term-fgx89 { color: #87005f; }
    .term-fgx90 { color: #870087; }
    .term-fgx91 { color: #8700af; }
    .term-fgx92 { color: #8700d7; }
    .term-fgx93 { color: #8700ff; }
    .term-fgx94 { color: #875f00; }
    .term-fgx95 { color: #875f5f; }
    .term-fgx96 { color: #875f87; }
    .term-fgx97 { color: #875faf; }
    .term-fgx98 { color: #875fd7; }
    .term-fgx99 { color: #875fff; }
    .term-fgx100 { color: #878700; }
    .term-fgx101 { color: #87875f; }
    .term-fgx102 { color: #878787; }
    .term-fgx103 { color: #8787af; }
    .term-fgx104 { color: #8787d7; }
    .term-fgx105 { color: #8787ff; }
    .term-fgx106 { color: #87af00; }
    .term-fgx107 { color: #87af5f; }
    .term-fgx108 { color: #87af87; }
    .term-fgx109 { color: #87afaf; }
    .term-fgx110 { color: #87afd7; }
    .term-fgx111 { color: #87afff; }
    .term-fgx112 { color: #87d700; }
    .term-fgx113 { color: #87d75f; }
    .term-fgx114 { color: #87d787; }
    .term-fgx115 { color: #87d7af; }
    .term-fgx116 { color: #87d7d7; }
    .term-fgx117 { color: #87d7ff; }
    .term-fgx118 { color: #87ff00; }
    .term-fgx119 { color: #87ff5f; }
    .term-fgx120 { color: #87ff87; }
    .term-fgx121 { color: #87ffaf; }
    .term-fgx122 { color: #87ffd7; }
    .term-fgx123 { color: #87ffff; }
    .term-fgx124 { color: #af0000; }
    .term-fgx125 { color: #af005f; }
    .term-fgx126 { color: #af0087; }
    .term-fgx127 { color: #af00af; }
    .term-fgx128 { color: #af00d7; }
    .term-fgx129 { color: #af00ff; }
    .term-fgx130 { color: #af5f00; }
    .term-fgx131 { color: #af5f5f; }
    .term-fgx132 { color: #af5f87; }
    .term-fgx133 { color: #af5faf; }
    .term-fgx134 { color: #af5fd7; }
    .term-fgx135 { color: #af5fff; }
    .term-fgx136 { color: #af8700; }
    .term-fgx137 { color: #af875f; }
    .term-fgx138 { color: #af8787; }
    .term-fgx139 { color: #af87af; }
    .term-fgx140 { color: #af87d7; }
    .term-fgx141 { color: #af87ff; }
    .term-fgx142 { color: #afaf00; }
    .term-fgx143 { color: #afaf5f; }
    .term-fgx144 { color: #afaf87; }
    .term-fgx145 { color: #afafaf; }
    .term-fgx146 { color: #afafd7; }
    .term-fgx147 { color: #afafff; }
    .term-fgx148 { color: #afd700; }
    .term-fgx149 { color: #afd75f; }
    .term-fgx150 { color: #afd787; }
    .term-fgx151 { color: #afd7af; }
    .term-fgx152 { color: #afd7d7; }
    .term-fgx153 { color: #afd7ff; }
    .term-fgx154 { color: #afff00; }
    .term-fgx155 { color: #afff5f; }
    .term-fgx156 { color: #afff87; }
    .term-fgx157 { color: #afffaf; }
    .term-fgx158 { color: #afffd7; }
    .term-fgx159 { color: #afffff; }
    .term-fgx160 { color: #d70000; }
    .term-fgx161 { color: #d7005f; }
    .term-fgx162 { color: #d70087; }
    .term-fgx163 { color: #d700af; }
    .term-fgx164 { color: #d700d7; }
    .term-fgx165 { color: #d700ff; }
    .term-fgx166 { color: #d75f00; }
    .term-fgx167 { color: #d75f5f; }
    .term-fgx168 { color: #d75f87; }
    .term-fgx169 { color: #d75faf; }
    .term-fgx170 { color: #d75fd7; }
    .term-fgx171 { color: #d75fff; }
    .term-fgx172 { color: #d78700; }
    .term-fgx173 { color: #d7875f; }
    .term-fgx174 { color: #d78787; }
    .term-fgx175 { color: #d787af; }
    .term-fgx176 { color: #d787d7; }
    .term-fgx177 { color: #d787ff; }
    .term-fgx178 { color: #d7af00; }
    .term-fgx179 { color: #d7af5f; }
    .term-fgx180 { color: #d7af87; }
    .term-fgx181 { color: #d7afaf; }
    .term-fgx182 { color: #d7afd7; }
    .term-fgx183 { color: #d7afff; }
    .term-fgx184 { color: #d7d700; }
    .term-fgx185 { color: #d7d75f; }
    .term-fgx186 { color: #d7d787; }
    .term-fgx187 { color: #d7d7af; }
    .term-fgx188 { color: #d7d7d7; }
    .term-fgx189 { color: #d7d7ff; }
    .term-fgx190 { color: #d7ff00; }
    .term-fgx191 { color: #d7ff5f; }
    .term-fgx192 { color: #d7ff87; }
    .term-fgx193 { color: #d7ffaf; }
    .term-fgx194 { color: #d7ffd7; }
    .term-fgx195 { color: #d7ffff; }
    .term-fgx196 { color: #ff0000; }
    .term-fgx197 { color: #ff005f; }
    .term-fgx198 { color: #ff0087; }
    .term-fgx199 { color: #ff00af; }
    .term-fgx200 { color: #ff00d7; }
    .term-fgx201 { color: #ff00ff; }
    .term-fgx202 { color: #ff5f00; }
    .term-fgx203 { color: #ff5f5f; }
    .term-fgx204 { color: #ff5f87; }
    .term-fgx205 { color: #ff5faf; }
    .term-fgx206 { color: #ff5fd7; }
    .term-fgx207 { color: #ff5fff; }
    .term-fgx208 { color: #ff8700; }
    .term-fgx209 { color: #ff875f; }
    .term-fgx210 { color: #ff8787; }
    .term-fgx211 { color: #ff87af; }
    .term-fgx212 { color: #ff87d7; }
    .term-fgx213 { color: #ff87ff; }
    .term-fgx214 { color: #ffaf00; }
    .term-fgx215 { color: #ffaf5f; }
    .term-fgx216 { color: #ffaf87; }
    .term-fgx217 { color: #ffafaf; }
    .term-fgx218 { color: #ffafd7; }
    .term-fgx219 { color: #ffafff; }
    .term-fgx220 { color: #ffd700; }
    .term-fgx221 { color: #ffd75f; }
    .term-fgx222 { color: #ffd787; }
    .term-fgx223 { color: #ffd7af; }
    .term-fgx224 { color: #ffd7d7; }
    .term-fgx225 { color: #ffd7ff; }
    .term-fgx226 { color: #ffff00; }
    .term-fgx227 { color: #ffff5f; }
    .term-fgx228 { color: #ffff87; }
    .term-fgx229 { color: #ffffaf; }
    .term-fgx230 { color: #ffffd7; }
    .term-fgx231 { color: #ffffff; }
    .term-fgx232 { color: #080808; }
    .term-fgx233 { color: #121212; }
    .term-fgx234 { color: #1c1c1c; }
    .term-fgx235 { color: #262626; }
    .term-fgx236 { color: #303030; }
    .term-fgx237 { color: #3a3a3a; }
    .term-fgx238 { color: #444444; }
    .term-fgx239 { color: #4e4e4e; }
    .term-fgx240 { color: #585858; }
    .term-fgx241 { color: #626262; }
    .term-fgx242 { color: #6c6c6c; }
    .term-fgx243 { color: #767676; }
    .term-fgx244 { color: #808080; }
    .term-fgx245 { color: #8a8a8a; }
    .term-fgx246 { color: #949494; }
    .term-fgx247 { color: #9e9e9e; }
    .term-fgx248 { color: #a8a8a8; }
    .term-fgx249 { color: #b2b2b2; }
    .term-fgx250 { color: #bcbcbc; }
    .term-fgx251 { color: #c6c6c6; }
    .term-fgx252 { color: #d0d0d0; }
    .term-fgx253 { color: #dadada; }
    .term-fgx254 { color: #e4e4e4; }
    .term-fgx255 { color: #eeeeee; }
</style>

</head>
<body>
    <div class="col-xl-10 col-xxl-8 mx-auto p-3 py-md-5">
        <main>
            <div>
    <div class="row">
        
            <div class="col-8 col-md-4  text-start"><h1>op-geth</h1></div>
        
        <div class="col-2 text-end mt-2"><span class="text-success">+1405</span></div>
        <div class="col-2 text-start mt-2"><span class="text-danger">-79</span></div>
    </div>
    <div class="row forkdef-content my-3">
        <div><p>Op-geth changes (TODO)</p>
</div>
        <div>
            
        </div>
        <div>
            
                <div>
    <div class="row">
        
            <div class="col-8 col-md-4  text-start"><h2>Consensus changes</h2></div>
        
        <div class="col-2 text-end mt-2"><span class="text-success">+162</span></div>
        <div class="col-2 text-start mt-2"><span class="text-danger">-5</span></div>
    </div>
    <div class="row forkdef-content my-3">
        <div></div>
        <div>
            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1b2d077078b4c8e8ff411646" role="button"
                   aria-expanded="false" aria-controls="id-1b2d077078b4c8e8ff411646">
                    <code>core/beacon/types.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+11</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/beacon/types.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/beacon/types.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1b2d077078b4c8e8ff411646"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;beacon&#47;types.go op-geth&#47;core&#47;beacon&#47;types.go</span>
<span class="term-fg1">index e06ab5c692d9784e4df25662b66b61ac223995df..1f06aa923c78a8c251fff72f22e955a54a33a671 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;beacon&#47;types.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;beacon&#47;types.go</span>
<span class="term-fg36">@@ -33,11 +33,21 @@</span> type PayloadAttributesV1 struct {
 	Timestamp             uint64         `json:&quot;timestamp&quot;     gencodec:&quot;required&quot;`
 	Random                common.Hash    `json:&quot;prevRandao&quot;        gencodec:&quot;required&quot;`
 	SuggestedFeeRecipient common.Address `json:&quot;suggestedFeeRecipient&quot;  gencodec:&quot;required&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Transactions is a field for rollups: the transactions list is forced into the block</span>
<span class="term-fg32">+	Transactions [][]byte `json:&quot;transactions,omitempty&quot;  gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+	&#47;&#47; NoTxPool is a field for rollups: if true, the no transactions are taken out of the tx-pool,</span>
<span class="term-fg32">+	&#47;&#47; only transactions from the above Transactions list will be included.</span>
<span class="term-fg32">+	NoTxPool bool `json:&quot;noTxPool,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+	&#47;&#47; GasLimit is a field for rollups: if set, this sets the exact gas limit the block produced with.</span>
<span class="term-fg32">+	GasLimit *uint64 `json:&quot;gasLimit,omitempty&quot; gencodec:&quot;optional&quot;`</span>
 }
&nbsp;
 &#47;&#47; JSON type overrides for PayloadAttributesV1.
 type payloadAttributesMarshaling struct {
<span class="term-fg31">-	Timestamp hexutil.Uint64</span>
<span class="term-fg32">+	Timestamp    hexutil.Uint64</span>
<span class="term-fg32">+	Transactions []hexutil.Bytes</span>
<span class="term-fg32">+	GasLimit     *hexutil.Uint64</span>
 }
&nbsp;
 &#47;&#47;go:generate go run github.com&#47;fjl&#47;gencodec -type ExecutableDataV1 -field-override executableDataMarshaling -out gen_ed.go</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b9da90e8323dfe6f2eeaf78d" role="button"
                   aria-expanded="false" aria-controls="id-b9da90e8323dfe6f2eeaf78d">
                    <code>core/txpool/list.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+9</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/txpool/list.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/txpool/list.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b9da90e8323dfe6f2eeaf78d"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;txpool&#47;list.go op-geth&#47;core&#47;txpool&#47;list.go</span>
<span class="term-fg1">index eb0c753f21e91ad4fbbc9dd43ab0bdee241ac3c7..0803160f82620d8bd7ff3a0a388a06d839e7133b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;txpool&#47;list.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;txpool&#47;list.go</span>
<span class="term-fg36">@@ -245,6 +245,15 @@</span> 	cache := m.flatten()
 	return cache[len(cache)-1]
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; FirstElement returns the first element from the heap (guaranteed to be lowest), thus, the</span>
<span class="term-fg32">+&#47;&#47; transaction with the lowest nonce. Returns nil if there are no elements.</span>
<span class="term-fg32">+func (m *sortedMap) FirstElement() *types.Transaction {</span>
<span class="term-fg32">+	if m.Len() == 0 {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return m.Get((*m.index)[0])</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; list is a &quot;list&quot; of transactions belonging to an account, sorted by account
 &#47;&#47; nonce. The same type can be used both for storing contiguous transactions for
 &#47;&#47; the executable&#47;pending queue; and for storing gapped transactions for the non-</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-82b2691359fa406b68038dca" role="button"
                   aria-expanded="false" aria-controls="id-82b2691359fa406b68038dca">
                    <code>core/types/receipt.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+37</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/receipt.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/receipt.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-82b2691359fa406b68038dca"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;receipt.go op-geth&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg1">index bdf48451473c3a3d15c808984b4b48fac7298f47..d04c22b0ae9bb96f343f2bcb238db27626a9440d 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg36">@@ -69,6 +69,12 @@</span> 	&#47;&#47; transaction corresponding to this receipt.
 	BlockHash        common.Hash `json:&quot;blockHash,omitempty&quot;`
 	BlockNumber      *big.Int    `json:&quot;blockNumber,omitempty&quot;`
 	TransactionIndex uint        `json:&quot;transactionIndex&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; OVM legacy: extend receipts with their L1 price (if a rollup tx)</span>
<span class="term-fg32">+	L1GasPrice *big.Int   `json:&quot;l1GasPrice,omitempty&quot;`</span>
<span class="term-fg32">+	L1GasUsed  *big.Int   `json:&quot;l1GasUsed,omitempty&quot;`</span>
<span class="term-fg32">+	L1Fee      *big.Int   `json:&quot;l1Fee,omitempty&quot;`</span>
<span class="term-fg32">+	FeeScalar  *big.Float `json:&quot;l1FeeScalar,omitempty&quot;`</span>
 }
&nbsp;
 type receiptMarshaling struct {
<span class="term-fg36">@@ -79,6 +85,12 @@</span> 	CumulativeGasUsed hexutil.Uint64
 	GasUsed           hexutil.Uint64
 	BlockNumber       *hexutil.Big
 	TransactionIndex  hexutil.Uint
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Optimism: extend receipts with their L1 price (if a rollup tx)</span>
<span class="term-fg32">+	L1GasPrice *hexutil.Big</span>
<span class="term-fg32">+	L1GasUsed  *hexutil.Big</span>
<span class="term-fg32">+	L1Fee      *hexutil.Big</span>
<span class="term-fg32">+	FeeScalar  *big.Float</span>
 }
&nbsp;
 &#47;&#47; receiptRLP is the consensus encoding of a receipt.
<span class="term-fg36">@@ -214,7 +226,7 @@</span> 	if len(b) &lt;= 1 {
 		return errShortTypedReceipt
 	}
 	switch b[0] {
<span class="term-fg31">-	case DynamicFeeTxType, AccessListTxType:</span>
<span class="term-fg32">+	case DynamicFeeTxType, AccessListTxType, DepositTxType:</span>
 		var data receiptRLP
 		err := rlp.DecodeBytes(b[1:], &amp;data)
 		if err != nil {
<span class="term-fg36">@@ -387,6 +399,9 @@</span> 		rlp.Encode(w, data)
 	case DynamicFeeTxType:
 		w.WriteByte(DynamicFeeTxType)
 		rlp.Encode(w, data)
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		w.WriteByte(DepositTxType)</span>
<span class="term-fg32">+		rlp.Encode(w, data)</span>
 	default:
 		&#47;&#47; For unsupported types, write nothing. Since this is for
 		&#47;&#47; DeriveSha, the error will be caught matching the derived hash
<span class="term-fg36">@@ -435,5 +450,26 @@</span> 			rs[i].Logs[j].Index = logIndex
 			logIndex++
 		}
 	}
<span class="term-fg32">+	if config.Optimism != nil &amp;&amp; len(txs) &gt;= 2 { &#47;&#47; need at least an info tx and a non-info tx</span>
<span class="term-fg32">+		if data := txs[0].Data(); len(data) &gt;= 4+32*8 { &#47;&#47; function selector + 8 arguments to setL1BlockValues</span>
<span class="term-fg32">+			l1Basefee := new(big.Int).SetBytes(data[4+32*2 : 4+32*3]) &#47;&#47; arg index 2</span>
<span class="term-fg32">+			overhead := new(big.Int).SetBytes(data[4+32*6 : 4+32*7])  &#47;&#47; arg index 6</span>
<span class="term-fg32">+			scalar := new(big.Int).SetBytes(data[4+32*7 : 4+32*8])    &#47;&#47; arg index 7</span>
<span class="term-fg32">+			fscalar := new(big.Float).SetInt(scalar)                  &#47;&#47; legacy: format fee scalar as big Float</span>
<span class="term-fg32">+			fdivisor := new(big.Float).SetUint64(1_000_000)           &#47;&#47; 10**6, i.e. 6 decimals</span>
<span class="term-fg32">+			feeScalar := new(big.Float).Quo(fscalar, fdivisor)</span>
<span class="term-fg32">+			for i := 0; i &lt; len(rs); i++ {</span>
<span class="term-fg32">+				if !txs[i].IsDepositTx() {</span>
<span class="term-fg32">+					rs[i].L1GasPrice = l1Basefee</span>
<span class="term-fg32">+					rs[i].L1GasUsed = new(big.Int).SetUint64(txs[i].RollupDataGas())</span>
<span class="term-fg32">+					rs[i].L1Fee = L1Cost(txs[i].RollupDataGas(), l1Basefee, overhead, scalar)</span>
<span class="term-fg32">+					rs[i].FeeScalar = feeScalar</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;L1 info tx only has %d bytes, cannot read gas price parameters&quot;, len(data))</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	return nil
 }</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1a5f08b5eb91a63d6b1e9b2c" role="button"
                   aria-expanded="false" aria-controls="id-1a5f08b5eb91a63d6b1e9b2c">
                    <code>core/beacon/gen_blockparams.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+29</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/beacon/gen_blockparams.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/beacon/gen_blockparams.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1a5f08b5eb91a63d6b1e9b2c"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;beacon&#47;gen_blockparams.go op-geth&#47;core&#47;beacon&#47;gen_blockparams.go</span>
<span class="term-fg1">index 0e2ea4bb1338268eec9751b9e2b173ea02abf871..d99be7517abc5e07e8e3bd40e5f1e7ccb4e4b135 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;beacon&#47;gen_blockparams.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;beacon&#47;gen_blockparams.go</span>
<span class="term-fg36">@@ -15,14 +15,25 @@</span>
 &#47;&#47; MarshalJSON marshals as JSON.
 func (p PayloadAttributesV1) MarshalJSON() ([]byte, error) {
 	type PayloadAttributesV1 struct {
<span class="term-fg31">-		Timestamp             hexutil.Uint64 `json:&quot;timestamp&quot;     gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-		Random                common.Hash    `json:&quot;prevRandao&quot;        gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-		SuggestedFeeRecipient common.Address `json:&quot;suggestedFeeRecipient&quot;  gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+		Timestamp             hexutil.Uint64  `json:&quot;timestamp&quot;     gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+		Random                common.Hash     `json:&quot;prevRandao&quot;        gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+		SuggestedFeeRecipient common.Address  `json:&quot;suggestedFeeRecipient&quot;  gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+		Transactions          []hexutil.Bytes `json:&quot;transactions,omitempty&quot;  gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		NoTxPool              bool            `json:&quot;noTxPool,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		GasLimit              *hexutil.Uint64 `json:&quot;gasLimit,omitempty&quot; gencodec:&quot;optional&quot;`</span>
 	}
 	var enc PayloadAttributesV1
 	enc.Timestamp = hexutil.Uint64(p.Timestamp)
 	enc.Random = p.Random
 	enc.SuggestedFeeRecipient = p.SuggestedFeeRecipient
<span class="term-fg32">+	if p.Transactions != nil {</span>
<span class="term-fg32">+		enc.Transactions = make([]hexutil.Bytes, len(p.Transactions))</span>
<span class="term-fg32">+		for k, v := range p.Transactions {</span>
<span class="term-fg32">+			enc.Transactions[k] = v</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	enc.NoTxPool = p.NoTxPool</span>
<span class="term-fg32">+	enc.GasLimit = (*hexutil.Uint64)(p.GasLimit)</span>
 	return json.Marshal(&amp;enc)
 }
&nbsp;
<span class="term-fg36">@@ -32,6 +43,9 @@</span> 	type PayloadAttributesV1 struct {
 		Timestamp             *hexutil.Uint64 `json:&quot;timestamp&quot;     gencodec:&quot;required&quot;`
 		Random                *common.Hash    `json:&quot;prevRandao&quot;        gencodec:&quot;required&quot;`
 		SuggestedFeeRecipient *common.Address `json:&quot;suggestedFeeRecipient&quot;  gencodec:&quot;required&quot;`
<span class="term-fg32">+		Transactions          []hexutil.Bytes `json:&quot;transactions,omitempty&quot;  gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		NoTxPool              *bool           `json:&quot;noTxPool,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		GasLimit              *hexutil.Uint64 `json:&quot;gasLimit,omitempty&quot; gencodec:&quot;optional&quot;`</span>
 	}
 	var dec PayloadAttributesV1
 	if err := json.Unmarshal(input, &amp;dec); err != nil {
<span class="term-fg36">@@ -49,5 +63,17 @@</span> 	if dec.SuggestedFeeRecipient == nil {
 		return errors.New(&quot;missing required field &#39;suggestedFeeRecipient&#39; for PayloadAttributesV1&quot;)
 	}
 	p.SuggestedFeeRecipient = *dec.SuggestedFeeRecipient
<span class="term-fg32">+	if dec.Transactions != nil {</span>
<span class="term-fg32">+		p.Transactions = make([][]byte, len(dec.Transactions))</span>
<span class="term-fg32">+		for k, v := range dec.Transactions {</span>
<span class="term-fg32">+			p.Transactions[k] = v</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.NoTxPool != nil {</span>
<span class="term-fg32">+		p.NoTxPool = *dec.NoTxPool</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.GasLimit != nil {</span>
<span class="term-fg32">+		p.GasLimit = (*uint64)(dec.GasLimit)</span>
<span class="term-fg32">+	}</span>
 	return nil
 }</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fba52d31bb7f1d32418899f4" role="button"
                   aria-expanded="false" aria-controls="id-fba52d31bb7f1d32418899f4">
                    <code>core/types/rollup_l1_cost.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+74</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/rollup_l1_cost.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fba52d31bb7f1d32418899f4"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;rollup_l1_cost.go op-geth&#47;core&#47;types&#47;rollup_l1_cost.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..edb2138881dca05e25e046a99bb0eba6e30a3da8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;rollup_l1_cost.go</span>
<span class="term-fg36">@@ -0,0 +1,74 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2022 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type RollupMessage interface {</span>
<span class="term-fg32">+	RollupDataGas() uint64</span>
<span class="term-fg32">+	IsDepositTx() bool</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type StateGetter interface {</span>
<span class="term-fg32">+	GetState(common.Address, common.Hash) common.Hash</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; L1CostFunc is used in the state transition to determine the cost of a rollup message.</span>
<span class="term-fg32">+&#47;&#47; Returns nil if there is no cost.</span>
<span class="term-fg32">+type L1CostFunc func(blockNum uint64, msg RollupMessage) *big.Int</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	L1BaseFeeSlot = common.BigToHash(big.NewInt(1))</span>
<span class="term-fg32">+	OverheadSlot  = common.BigToHash(big.NewInt(5))</span>
<span class="term-fg32">+	ScalarSlot    = common.BigToHash(big.NewInt(6))</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var L1BlockAddr = common.HexToAddress(&quot;0x4200000000000000000000000000000000000015&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewL1CostFunc returns a function used for calculating L1 fee cost.</span>
<span class="term-fg32">+&#47;&#47; This depends on the oracles because gas costs can change over time.</span>
<span class="term-fg32">+&#47;&#47; It returns nil if there is no applicable cost function.</span>
<span class="term-fg32">+func NewL1CostFunc(config *params.ChainConfig, statedb StateGetter) L1CostFunc {</span>
<span class="term-fg32">+	cacheBlockNum := ^uint64(0)</span>
<span class="term-fg32">+	var l1BaseFee, overhead, scalar *big.Int</span>
<span class="term-fg32">+	return func(blockNum uint64, msg RollupMessage) *big.Int {</span>
<span class="term-fg32">+		rollupDataGas := msg.RollupDataGas() &#47;&#47; Only fake txs for RPC view-calls are 0.</span>
<span class="term-fg32">+		if config.Optimism == nil || msg.IsDepositTx() || rollupDataGas == 0 {</span>
<span class="term-fg32">+			return nil</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if blockNum != cacheBlockNum {</span>
<span class="term-fg32">+			l1BaseFee = statedb.GetState(L1BlockAddr, L1BaseFeeSlot).Big()</span>
<span class="term-fg32">+			overhead = statedb.GetState(L1BlockAddr, OverheadSlot).Big()</span>
<span class="term-fg32">+			scalar = statedb.GetState(L1BlockAddr, ScalarSlot).Big()</span>
<span class="term-fg32">+			cacheBlockNum = blockNum</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return L1Cost(rollupDataGas, l1BaseFee, overhead, scalar)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func L1Cost(rollupDataGas uint64, l1BaseFee, overhead, scalar *big.Int) *big.Int {</span>
<span class="term-fg32">+	l1GasUsed := new(big.Int).SetUint64(rollupDataGas)</span>
<span class="term-fg32">+	l1GasUsed = l1GasUsed.Add(l1GasUsed, overhead)</span>
<span class="term-fg32">+	l1Cost := l1GasUsed.Mul(l1GasUsed, l1BaseFee)</span>
<span class="term-fg32">+	l1Cost = l1Cost.Mul(l1Cost, scalar)</span>
<span class="term-fg32">+	return l1Cost.Div(l1Cost, big.NewInt(1_000_000))</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-65f4df0fc51a5226e535896e" role="button"
                   aria-expanded="false" aria-controls="id-65f4df0fc51a5226e535896e">
                    <code>core/types/tx_access_list.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/tx_access_list.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/tx_access_list.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-65f4df0fc51a5226e535896e"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;tx_access_list.go op-geth&#47;core&#47;types&#47;tx_access_list.go</span>
<span class="term-fg1">index 620848fe624a30d4ebaa86932da53da4a6f99490..2ed0295cd3f8c75a2b52c1a98dd05107dada6bb9 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;tx_access_list.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;tx_access_list.go</span>
<span class="term-fg36">@@ -105,6 +105,7 @@</span> func (tx *AccessListTx) gasFeeCap() *big.Int    { return tx.GasPrice }
 func (tx *AccessListTx) value() *big.Int        { return tx.Value }
 func (tx *AccessListTx) nonce() uint64          { return tx.Nonce }
 func (tx *AccessListTx) to() *common.Address    { return tx.To }
<span class="term-fg32">+func (tx *AccessListTx) isSystemTx() bool       { return false }</span>
&nbsp;
 func (tx *AccessListTx) rawSignatureValues() (v, r, s *big.Int) {
 	return tx.V, tx.R, tx.S</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bec4b1cb602f4ca1b410f50f" role="button"
                   aria-expanded="false" aria-controls="id-bec4b1cb602f4ca1b410f50f">
                    <code>core/types/tx_dynamic_fee.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/tx_dynamic_fee.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/tx_dynamic_fee.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bec4b1cb602f4ca1b410f50f"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;tx_dynamic_fee.go op-geth&#47;core&#47;types&#47;tx_dynamic_fee.go</span>
<span class="term-fg1">index 53f246ea1fadc9dedeae876063819e08a3eb49ac..697da1ffd0a87edb479e4b8c4e0d730b21efc2c3 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;tx_dynamic_fee.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;tx_dynamic_fee.go</span>
<span class="term-fg36">@@ -93,6 +93,7 @@</span> func (tx *DynamicFeeTx) gasPrice() *big.Int     { return tx.GasFeeCap }
 func (tx *DynamicFeeTx) value() *big.Int        { return tx.Value }
 func (tx *DynamicFeeTx) nonce() uint64          { return tx.Nonce }
 func (tx *DynamicFeeTx) to() *common.Address    { return tx.To }
<span class="term-fg32">+func (tx *DynamicFeeTx) isSystemTx() bool       { return false }</span>
&nbsp;
 func (tx *DynamicFeeTx) rawSignatureValues() (v, r, s *big.Int) {
 	return tx.V, tx.R, tx.S</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div>
    <div class="row">
        
            <div class="col-8 col-md-4  text-start"><h2>Engine API changes</h2></div>
        
        <div class="col-2 text-end mt-2"><span class="text-success">+30</span></div>
        <div class="col-2 text-start mt-2"><span class="text-danger">-2</span></div>
    </div>
    <div class="row forkdef-content my-3">
        <div></div>
        <div>
            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-875c5a1225713c6f6d201eff" role="button"
                   aria-expanded="false" aria-controls="id-875c5a1225713c6f6d201eff">
                    <code>eth/catalyst/api.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+30</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/catalyst/api.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/catalyst/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-875c5a1225713c6f6d201eff"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;catalyst&#47;api.go op-geth&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg1">index 030a398374728af658c0de790df1be5c80e8a2da..54a3c2dec5ab6897822cb6893d722d4f43c93f84 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg36">@@ -138,6 +138,9 @@</span> 		invalidBlocksHits: make(map[common.Hash]int),
 		invalidTipsets:    make(map[common.Hash]*types.Header),
 	}
 	eth.Downloader().SetBadBlockCallback(api.setInvalidAncestor)
<span class="term-fg32">+	if api.eth.BlockChain().Config().Optimism != nil { &#47;&#47; don&#39;t start the api heartbeat, there is no transition</span>
<span class="term-fg32">+		return api</span>
<span class="term-fg32">+	}</span>
 	go api.heartbeat()
&nbsp;
 	return api
<span class="term-fg36">@@ -238,7 +241,7 @@</span> 	} else if api.eth.BlockChain().CurrentBlock().Hash() == update.HeadBlockHash {
 		&#47;&#47; If the specified head matches with our local head, do nothing and keep
 		&#47;&#47; generating the payload. It&#39;s a special corner case that a few slots are
 		&#47;&#47; missing and we are requested to generate the payload in slot.
<span class="term-fg31">-	} else {</span>
<span class="term-fg32">+	} else if api.eth.BlockChain().Config().Optimism == nil { &#47;&#47; minor Engine API divergence: allow proposers to reorg their own chain</span>
 		&#47;&#47; If the head block is already in our canonical chain, the beacon client is
 		&#47;&#47; probably resyncing. Ignore the update.
 		log.Info(&quot;Ignoring beacon update to old head&quot;, &quot;number&quot;, block.NumberU64(), &quot;hash&quot;, update.HeadBlockHash, &quot;age&quot;, common.PrettyAge(time.Unix(int64(block.Time()), 0)), &quot;have&quot;, api.eth.BlockChain().CurrentBlock().NumberU64())
<span class="term-fg36">@@ -282,16 +285,30 @@</span> 	&#47;&#47; If payload generation was requested, create a new block to be potentially
 	&#47;&#47; sealed by the beacon client. The payload will be requested later, and we
 	&#47;&#47; will replace it arbitrarily many times in between.
 	if payloadAttributes != nil {
<span class="term-fg32">+		if api.eth.BlockChain().Config().Optimism != nil &amp;&amp; payloadAttributes.GasLimit == nil {</span>
<span class="term-fg32">+			return beacon.STATUS_INVALID, beacon.InvalidPayloadAttributes.With(errors.New(&quot;gasLimit parameter is required&quot;))</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		transactions := make(types.Transactions, 0, len(payloadAttributes.Transactions))</span>
<span class="term-fg32">+		for i, otx := range payloadAttributes.Transactions {</span>
<span class="term-fg32">+			var tx types.Transaction</span>
<span class="term-fg32">+			if err := tx.UnmarshalBinary(otx); err != nil {</span>
<span class="term-fg32">+				return beacon.STATUS_INVALID, fmt.Errorf(&quot;transaction %d is not valid: %v&quot;, i, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			transactions = append(transactions, &amp;tx)</span>
<span class="term-fg32">+		}</span>
 		args := &amp;miner.BuildPayloadArgs{
 			Parent:       update.HeadBlockHash,
 			Timestamp:    payloadAttributes.Timestamp,
 			FeeRecipient: payloadAttributes.SuggestedFeeRecipient,
 			Random:       payloadAttributes.Random,
<span class="term-fg32">+			NoTxPool:     payloadAttributes.NoTxPool,</span>
<span class="term-fg32">+			Transactions: transactions,</span>
<span class="term-fg32">+			GasLimit:     payloadAttributes.GasLimit,</span>
 		}
 		payload, err := api.eth.Miner().BuildPayload(args)
 		if err != nil {
 			log.Error(&quot;Failed to build payload&quot;, &quot;err&quot;, err)
<span class="term-fg31">-			return valid(nil), beacon.InvalidPayloadAttributes.With(err)</span>
<span class="term-fg32">+			return beacon.STATUS_INVALID, beacon.InvalidPayloadAttributes.With(err)</span>
 		}
 		id := computePayloadId(update.HeadBlockHash, payloadAttributes)
 		api.localBlocks.put(id, payload)
<span class="term-fg36">@@ -451,6 +468,17 @@</span> 	hasher.Write(headBlockHash[:])
 	binary.Write(hasher, binary.BigEndian, params.Timestamp)
 	hasher.Write(params.Random[:])
 	hasher.Write(params.SuggestedFeeRecipient[:])
<span class="term-fg32">+	if params.NoTxPool || len(params.Transactions) &gt; 0 { &#47;&#47; extend if extra payload attributes are used</span>
<span class="term-fg32">+		binary.Write(hasher, binary.BigEndian, params.NoTxPool)</span>
<span class="term-fg32">+		binary.Write(hasher, binary.BigEndian, uint64(len(params.Transactions)))</span>
<span class="term-fg32">+		for _, tx := range params.Transactions {</span>
<span class="term-fg32">+			binary.Write(hasher, binary.BigEndian, uint64(len(tx)))</span>
<span class="term-fg32">+			hasher.Write(tx)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if params.GasLimit != nil {</span>
<span class="term-fg32">+		binary.Write(hasher, binary.BigEndian, *params.GasLimit)</span>
<span class="term-fg32">+	}</span>
 	var out beacon.PayloadID
 	copy(out[:], hasher.Sum(nil)[:8])
 	return out</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div>
    <div class="row">
        
            <div class="col-8 col-md-4  text-start"><h2>Other changes</h2></div>
        
        <div class="col-2 text-end mt-2"><span class="text-success">+1213</span></div>
        <div class="col-2 text-start mt-2"><span class="text-danger">-72</span></div>
    </div>
    <div class="row forkdef-content my-3">
        <div></div>
        <div>
            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1d62382dfe0ccf4ff80eb858" role="button"
                   aria-expanded="false" aria-controls="id-1d62382dfe0ccf4ff80eb858">
                    <code>.circleci/config.yml</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+71</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/.circleci/config.yml" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1d62382dfe0ccf4ff80eb858"><span class="term-fg1">diff --git go-ethereum&#47;.circleci&#47;config.yml op-geth&#47;.circleci&#47;config.yml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1e98f5c3952ea8f42a08bc56ee6d2951e347e244</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;.circleci&#47;config.yml</span>
<span class="term-fg36">@@ -0,0 +1,71 @@</span>
<span class="term-fg32">+version: 2.1</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  build-geth:</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;go:1.18</span>
<span class="term-fg32">+    resource_class: medium</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          command: go run build&#47;ci.go install</span>
<span class="term-fg32">+  unit-test:</span>
<span class="term-fg32">+    resource_class: medium</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;go:1.18</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          command: go run build&#47;ci.go test</span>
<span class="term-fg32">+  lint-geth:</span>
<span class="term-fg32">+    resource_class: medium</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;go:1.18</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          command: go run build&#47;ci.go lint</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+  push-geth:</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;base:2022.04</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - when:</span>
<span class="term-fg32">+          condition:</span>
<span class="term-fg32">+            or:</span>
<span class="term-fg32">+              - equal: [ optimism, &lt;&lt;pipeline.git.branch&gt;&gt; ]</span>
<span class="term-fg32">+              - equal: [ optimism-history, &lt;&lt;pipeline.git.branch&gt;&gt; ]</span>
<span class="term-fg32">+          steps:</span>
<span class="term-fg32">+            - checkout</span>
<span class="term-fg32">+            - setup_remote_docker:</span>
<span class="term-fg32">+                version: 20.10.12</span>
<span class="term-fg32">+            - run:</span>
<span class="term-fg32">+                name: Build and push</span>
<span class="term-fg32">+                command: |</span>
<span class="term-fg32">+                  echo &quot;$DOCKER_PASS&quot; | docker login -u &quot;$DOCKER_USERNAME&quot; --password-stdin</span>
<span class="term-fg32">+                  docker build -t &quot;ethereumoptimism&#47;op-geth:$CIRCLE_SHA1&quot; -f Dockerfile .</span>
<span class="term-fg32">+                  docker tag &quot;ethereumoptimism&#47;op-geth:$CIRCLE_SHA1&quot; &quot;ethereumoptimism&#47;op-geth:$CIRCLE_BRANCH&quot;</span>
<span class="term-fg32">+                  docker push &quot;ethereumoptimism&#47;op-geth:$CIRCLE_SHA1&quot;</span>
<span class="term-fg32">+                  docker push &quot;ethereumoptimism&#47;op-geth:$CIRCLE_BRANCH&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                  if [ $CIRCLE_BRANCH = &quot;optimism&quot; ]</span>
<span class="term-fg32">+                  then</span>
<span class="term-fg32">+                    docker tag &quot;ethereumoptimism&#47;op-geth:$CIRCLE_SHA1&quot; &quot;ethereumoptimism&#47;op-geth:latest&quot;</span>
<span class="term-fg32">+                    docker push &quot;ethereumoptimism&#47;op-geth:latest&quot;</span>
<span class="term-fg32">+                  pwd</span>
<span class="term-fg32">+                  fi</span>
<span class="term-fg32">+      # Below step is required to prevent CircleCI from barfing on a</span>
<span class="term-fg32">+      # job with no steps</span>
<span class="term-fg32">+      - run: echo 0</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+workflows:</span>
<span class="term-fg32">+  main:</span>
<span class="term-fg32">+    jobs:</span>
<span class="term-fg32">+      - build-geth:</span>
<span class="term-fg32">+          name: Build geth</span>
<span class="term-fg32">+      - unit-test:</span>
<span class="term-fg32">+          name: Run unit tests for geth</span>
<span class="term-fg32">+      - lint-geth:</span>
<span class="term-fg32">+          name: Run linter over geth</span>
<span class="term-fg32">+      - push-geth:</span>
<span class="term-fg32">+          name: Push geth</span></div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9f52fa099d72e02aafa7b317" role="button"
                   aria-expanded="false" aria-controls="id-9f52fa099d72e02aafa7b317">
                    <code>accounts/abi/bind/backends/simulated.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+94</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-18</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/accounts/abi/bind/backends/simulated.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/accounts/abi/bind/backends/simulated.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9f52fa099d72e02aafa7b317"><span class="term-fg1">diff --git go-ethereum&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go op-geth&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go</span>
<span class="term-fg1">index 4c259e03c93cd7bee12ca65fc3d26ac341b95295..a25a398e27e0dcb0391897f150a2694411048af8 100644</span>
<span class="term-fg1">--- go-ethereum&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go</span>
<span class="term-fg1">+++ op-geth&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go</span>
<span class="term-fg36">@@ -30,6 +30,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&#47;bind&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;ethash&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;bloombits&quot;
<span class="term-fg36">@@ -63,6 +64,8 @@</span> type SimulatedBackend struct {
 	database   ethdb.Database   &#47;&#47; In memory database to store our testing data
 	blockchain *core.BlockChain &#47;&#47; Ethereum blockchain to handle the consensus
&nbsp;
<span class="term-fg32">+	consensus consensus.Engine</span>
<span class="term-fg32">+</span>
 	mu              sync.Mutex
 	pendingBlock    *types.Block   &#47;&#47; Currently pending block that will be imported on request
 	pendingState    *state.StateDB &#47;&#47; Currently pending state that will be the active on request
<span class="term-fg36">@@ -78,20 +81,93 @@</span> &#47;&#47; NewSimulatedBackendWithDatabase creates a new binding backend based on the given database
 &#47;&#47; and uses a simulated blockchain for testing purposes.
 &#47;&#47; A simulated backend always uses chainID 1337.
 func NewSimulatedBackendWithDatabase(database ethdb.Database, alloc core.GenesisAlloc, gasLimit uint64) *SimulatedBackend {
<span class="term-fg31">-	genesis := core.Genesis{</span>
<span class="term-fg31">-		Config:   params.AllEthashProtocolChanges,</span>
<span class="term-fg31">-		GasLimit: gasLimit,</span>
<span class="term-fg31">-		Alloc:    alloc,</span>
<span class="term-fg32">+	return NewSimulatedBackendWithOpts(WithDatabase(database), WithAlloc(alloc), WithGasLimit(gasLimit))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewSimulatedBackend creates a new binding backend using a simulated blockchain</span>
<span class="term-fg32">+&#47;&#47; for testing purposes.</span>
<span class="term-fg32">+&#47;&#47; A simulated backend always uses chainID 1337.</span>
<span class="term-fg32">+func NewSimulatedBackend(alloc core.GenesisAlloc, gasLimit uint64) *SimulatedBackend {</span>
<span class="term-fg32">+	return NewSimulatedBackendWithOpts(WithGasLimit(gasLimit), WithAlloc(alloc))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type simulatedBackendConfig struct {</span>
<span class="term-fg32">+	genesis     core.Genesis</span>
<span class="term-fg32">+	cacheConfig *core.CacheConfig</span>
<span class="term-fg32">+	database    ethdb.Database</span>
<span class="term-fg32">+	vmConfig    vm.Config</span>
<span class="term-fg32">+	consensus   consensus.Engine</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type SimulatedBackendOpt func(s *simulatedBackendConfig)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithDatabase(database ethdb.Database) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.database = database</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithGasLimit(gasLimit uint64) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.genesis.GasLimit = gasLimit</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithAlloc(alloc core.GenesisAlloc) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.genesis.Alloc = alloc</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithCacheConfig(cacheConfig *core.CacheConfig) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.cacheConfig = cacheConfig</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithGenesis(genesis core.Genesis) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.genesis = genesis</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithVMConfig(vmConfig vm.Config) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.vmConfig = vmConfig</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithConsensus(consensus consensus.Engine) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.consensus = consensus</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewSimulatedBackendWithOpts creates a new binding backend based on the given database</span>
<span class="term-fg32">+&#47;&#47; and uses a simulated blockchain for testing purposes. It exposes additional configuration</span>
<span class="term-fg32">+&#47;&#47; options that are useful to</span>
<span class="term-fg32">+func NewSimulatedBackendWithOpts(opts ...SimulatedBackendOpt) *SimulatedBackend {</span>
<span class="term-fg32">+	config := &amp;simulatedBackendConfig{</span>
<span class="term-fg32">+		genesis:   core.Genesis{Config: params.AllEthashProtocolChanges, GasLimit: 100000000, Alloc: make(core.GenesisAlloc)},</span>
<span class="term-fg32">+		database:  rawdb.NewMemoryDatabase(),</span>
<span class="term-fg32">+		consensus: ethash.NewFaker(),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for _, opt := range opts {</span>
<span class="term-fg32">+		opt(config)</span>
 	}
<span class="term-fg31">-	blockchain, _ := core.NewBlockChain(database, nil, &amp;genesis, nil, ethash.NewFaker(), vm.Config{}, nil, nil)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	config.genesis.MustCommit(config.database)</span>
<span class="term-fg32">+	blockchain, _ := core.NewBlockChain(config.database, config.cacheConfig, &amp;config.genesis, nil, config.consensus, config.vmConfig, nil, nil)</span>
&nbsp;
 	backend := &amp;SimulatedBackend{
<span class="term-fg31">-		database:   database,</span>
<span class="term-fg32">+		database:   config.database,</span>
 		blockchain: blockchain,
<span class="term-fg31">-		config:     genesis.Config,</span>
<span class="term-fg32">+		config:     config.genesis.Config,</span>
<span class="term-fg32">+		consensus:  config.consensus,</span>
 	}
&nbsp;
<span class="term-fg31">-	filterBackend := &amp;filterBackend{database, blockchain, backend}</span>
<span class="term-fg32">+	filterBackend := &amp;filterBackend{config.database, blockchain, backend}</span>
 	backend.filterSystem = filters.NewFilterSystem(filterBackend, filters.Config{})
 	backend.events = filters.NewEventSystem(backend.filterSystem, false)
&nbsp;
<span class="term-fg36">@@ -99,13 +175,6 @@</span> 	backend.rollback(blockchain.CurrentBlock())
 	return backend
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; NewSimulatedBackend creates a new binding backend using a simulated blockchain</span>
<span class="term-fg31">-&#47;&#47; for testing purposes.</span>
<span class="term-fg31">-&#47;&#47; A simulated backend always uses chainID 1337.</span>
<span class="term-fg31">-func NewSimulatedBackend(alloc core.GenesisAlloc, gasLimit uint64) *SimulatedBackend {</span>
<span class="term-fg31">-	return NewSimulatedBackendWithDatabase(rawdb.NewMemoryDatabase(), alloc, gasLimit)</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
 &#47;&#47; Close terminates the underlying blockchain&#39;s update loop.
 func (b *SimulatedBackend) Close() error {
 	b.blockchain.Stop()
<span class="term-fg36">@@ -121,6 +190,8 @@</span>
 	if _, err := b.blockchain.InsertChain([]*types.Block{b.pendingBlock}); err != nil {
 		panic(err) &#47;&#47; This cannot happen unless the simulator is wrong, fail in that case
 	}
<span class="term-fg32">+	&#47;&#47; Don&#39;t wait for the async tx indexing</span>
<span class="term-fg32">+	rawdb.WriteTxLookupEntriesByBlock(b.database, b.pendingBlock)</span>
 	blockHash := b.pendingBlock.Hash()
&nbsp;
 	&#47;&#47; Using the last inserted block here makes it possible to build on a side
<span class="term-fg36">@@ -139,7 +210,7 @@</span> 	b.rollback(b.blockchain.CurrentBlock())
 }
&nbsp;
 func (b *SimulatedBackend) rollback(parent *types.Block) {
<span class="term-fg31">-	blocks, _ := core.GenerateChain(b.config, parent, ethash.NewFaker(), b.database, 1, func(int, *core.BlockGen) {})</span>
<span class="term-fg32">+	blocks, _ := core.GenerateChain(b.config, parent, b.consensus, b.database, 1, func(int, *core.BlockGen) {})</span>
&nbsp;
 	b.pendingBlock = blocks[0]
 	b.pendingState, _ = state.New(b.pendingBlock.Root(), b.blockchain.StateCache(), nil)
<span class="term-fg36">@@ -646,6 +717,7 @@</span> 	msg := callMsg{call}
&nbsp;
 	txContext := core.NewEVMTxContext(msg)
 	evmContext := core.NewEVMBlockContext(block.Header(), b.blockchain, nil)
<span class="term-fg32">+	evmContext.L1CostFunc = types.NewL1CostFunc(b.config, stateDB)</span>
 	&#47;&#47; Create a new environment which holds all relevant information
 	&#47;&#47; about the transaction and calling mechanisms.
 	vmEnv := vm.NewEVM(evmContext, txContext, stateDB, b.config, vm.Config{NoBaseFee: true})
<span class="term-fg36">@@ -675,7 +747,7 @@</span> 	if tx.Nonce() != nonce {
 		return fmt.Errorf(&quot;invalid transaction nonce: got %d, want %d&quot;, tx.Nonce(), nonce)
 	}
 	&#47;&#47; Include tx in chain
<span class="term-fg31">-	blocks, receipts := core.GenerateChain(b.config, block, ethash.NewFaker(), b.database, 1, func(number int, block *core.BlockGen) {</span>
<span class="term-fg32">+	blocks, receipts := core.GenerateChain(b.config, block, b.consensus, b.database, 1, func(number int, block *core.BlockGen) {</span>
 		for _, tx := range b.pendingBlock.Transactions() {
 			block.AddTxWithChain(b.blockchain, tx)
 		}
<span class="term-fg36">@@ -799,7 +871,7 @@</span> 	if block == nil {
 		return fmt.Errorf(&quot;could not find parent&quot;)
 	}
&nbsp;
<span class="term-fg31">-	blocks, _ := core.GenerateChain(b.config, block, ethash.NewFaker(), b.database, 1, func(number int, block *core.BlockGen) {</span>
<span class="term-fg32">+	blocks, _ := core.GenerateChain(b.config, block, b.consensus, b.database, 1, func(number int, block *core.BlockGen) {</span>
 		block.OffsetTime(int64(adjustment.Seconds()))
 	})
 	stateDB, _ := b.blockchain.State()
<span class="term-fg36">@@ -831,6 +903,10 @@</span> func (m callMsg) Gas() uint64                  { return m.CallMsg.Gas }
 func (m callMsg) Value() *big.Int              { return m.CallMsg.Value }
 func (m callMsg) Data() []byte                 { return m.CallMsg.Data }
 func (m callMsg) AccessList() types.AccessList { return m.CallMsg.AccessList }
<span class="term-fg32">+func (m callMsg) IsSystemTx() bool             { return false }</span>
<span class="term-fg32">+func (m callMsg) IsDepositTx() bool            { return false }</span>
<span class="term-fg32">+func (m callMsg) Mint() *big.Int               { return nil }</span>
<span class="term-fg32">+func (m callMsg) RollupDataGas() uint64        { return 0 }</span>
&nbsp;
 &#47;&#47; filterBackend implements filters.Backend to support filtering for logs without
 &#47;&#47; taking bloom-bits acceleration structures into account.</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-980fd76e55eda6f3c163b5c4" role="button"
                   aria-expanded="false" aria-controls="id-980fd76e55eda6f3c163b5c4">
                    <code>build/ci.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/build/ci.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/build/ci.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-980fd76e55eda6f3c163b5c4"><span class="term-fg1">diff --git go-ethereum&#47;build&#47;ci.go op-geth&#47;build&#47;ci.go</span>
<span class="term-fg1">index 572519b9698e584cae7169a5705e5a0a2b095ef0..db336a8ef804842e8612b776df3edde97458ba5a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;build&#47;ci.go</span>
<span class="term-fg1">+++ op-geth&#47;build&#47;ci.go</span>
<span class="term-fg36">@@ -517,7 +517,7 @@</span> 	switch {
 	case env.Branch == &quot;master&quot;:
 		tags = []string{&quot;latest&quot;}
 	case strings.HasPrefix(env.Tag, &quot;v1.&quot;):
<span class="term-fg31">-		tags = []string{&quot;stable&quot;, fmt.Sprintf(&quot;release-1.%d&quot;, params.VersionMinor), &quot;v&quot; + params.Version}</span>
<span class="term-fg32">+		tags = []string{&quot;stable&quot;, fmt.Sprintf(&quot;release-1.%d&quot;, params.OPVersionMinor), &quot;v&quot; + params.Version}</span>
 	}
 	&#47;&#47; If architecture specific image builds are requested, build and push them
 	if *image {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a79841e54ef4406fcc0a868f" role="button"
                   aria-expanded="false" aria-controls="id-a79841e54ef4406fcc0a868f">
                    <code>cmd/evm/internal/t8ntool/execution.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+2</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/cmd/evm/internal/t8ntool/execution.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/cmd/evm/internal/t8ntool/execution.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a79841e54ef4406fcc0a868f"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg1">index a27c6f6b4f4bf60b9fe27e165975f270d83124ff..6c6455fa31c19a69647398f8ef25f0b2ec93ab13 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg36">@@ -21,6 +21,8 @@</span> 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
 	&quot;os&quot;
&nbsp;
<span class="term-fg32">+	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;ethash&quot;
<span class="term-fg36">@@ -36,7 +38,6 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;trie&quot;
<span class="term-fg31">-	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;</span>
 )
&nbsp;
 type Prestate struct {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f3ce551f1022441fff1bf06d" role="button"
                   aria-expanded="false" aria-controls="id-f3ce551f1022441fff1bf06d">
                    <code>cmd/geth/main.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+3</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/cmd/geth/main.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/cmd/geth/main.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f3ce551f1022441fff1bf06d"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;geth&#47;main.go op-geth&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg1">index a94c0c17db3b600ae074de51aaa71a69dadd0f73..5b3b2a0288eb46735d4438bb52ee92f8f2e31503 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg36">@@ -150,6 +150,9 @@</span> 		utils.GpoMaxGasPriceFlag,
 		utils.GpoIgnoreGasPriceFlag,
 		utils.MinerNotifyFullFlag,
 		utils.IgnoreLegacyReceiptsFlag,
<span class="term-fg32">+		utils.RollupSequencerHTTPFlag,</span>
<span class="term-fg32">+		utils.RollupHistoricalRPCFlag,</span>
<span class="term-fg32">+		utils.RollupDisableTxPoolGossipFlag,</span>
 		configFileFlag,
 	}, utils.NetworkFlags, utils.DatabasePathFlags)
</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-df0b2fb2367de10c9cce271a" role="button"
                   aria-expanded="false" aria-controls="id-df0b2fb2367de10c9cce271a">
                    <code>cmd/geth/misccmd.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/cmd/geth/misccmd.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/cmd/geth/misccmd.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-df0b2fb2367de10c9cce271a"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;geth&#47;misccmd.go op-geth&#47;cmd&#47;geth&#47;misccmd.go</span>
<span class="term-fg1">index d8a523c6322168c5c532e81a05b8fb5a4933d642..5ca1732e07ade07abae15ce53e042f97e1be8634 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;geth&#47;misccmd.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;geth&#47;misccmd.go</span>
<span class="term-fg36">@@ -137,6 +137,7 @@</span> 	}
 	if git.Date != &quot;&quot; {
 		fmt.Println(&quot;Git Commit Date:&quot;, git.Date)
 	}
<span class="term-fg32">+	fmt.Println(&quot;Upstream Version:&quot;, params.GethVersionWithMeta)</span>
 	fmt.Println(&quot;Architecture:&quot;, runtime.GOARCH)
 	fmt.Println(&quot;Go Version:&quot;, runtime.Version())
 	fmt.Println(&quot;Operating System:&quot;, runtime.GOOS)</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5731aad8f4a6ef9a31dd9adc" role="button"
                   aria-expanded="false" aria-controls="id-5731aad8f4a6ef9a31dd9adc">
                    <code>cmd/utils/flags.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+31</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/cmd/utils/flags.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/cmd/utils/flags.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5731aad8f4a6ef9a31dd9adc"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;utils&#47;flags.go op-geth&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg1">index 974c035795071b02ea534ae4ad86237ea98f80fb..8a3026c7bdc2411bff82294274f55a8d2d5cda9e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg36">@@ -33,6 +33,10 @@</span> 	&quot;strconv&quot;
 	&quot;strings&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg32">+	pcsclite &quot;github.com&#47;gballet&#47;go-libpcsclite&quot;</span>
<span class="term-fg32">+	gopsutil &quot;github.com&#47;shirou&#47;gopsutil&#47;mem&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;keystore&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -73,9 +77,6 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;p2p&#47;netutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
<span class="term-fg31">-	pcsclite &quot;github.com&#47;gballet&#47;go-libpcsclite&quot;</span>
<span class="term-fg31">-	gopsutil &quot;github.com&#47;shirou&#47;gopsutil&#47;mem&quot;</span>
<span class="term-fg31">-	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;</span>
 )
&nbsp;
 &#47;&#47; These are all the command line flags we support.
<span class="term-fg36">@@ -907,6 +908,25 @@</span> 		Name:     &quot;gpo.ignoreprice&quot;,
 		Usage:    &quot;Gas price below which gpo will ignore transactions&quot;,
 		Value:    ethconfig.Defaults.GPO.IgnorePrice.Int64(),
 		Category: flags.GasPriceCategory,
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Rollup Flags</span>
<span class="term-fg32">+	RollupSequencerHTTPFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;rollup.sequencerhttp&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;HTTP endpoint for the sequencer mempool&quot;,</span>
<span class="term-fg32">+		Category: flags.RollupCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupHistoricalRPCFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;rollup.historicalrpc&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;RPC endpoint for historical data.&quot;,</span>
<span class="term-fg32">+		Category: flags.RollupCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupDisableTxPoolGossipFlag = &amp;cli.BoolFlag{</span>
<span class="term-fg32">+		Name:     &quot;rollup.disabletxpoolgossip&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Disable transaction pool gossip.&quot;,</span>
<span class="term-fg32">+		Category: flags.RollupCategory,</span>
 	}
&nbsp;
 	&#47;&#47; Metrics flags
<span class="term-fg36">@@ -1904,6 +1924,14 @@</span> 			Fatalf(&quot;Failed to decode block: %v&quot;, err)
 		}
 		cfg.SyncTarget = &amp;block
 	}
<span class="term-fg32">+	&#47;&#47; Only configure sequencer http flag if we&#39;re running in verifier mode i.e. --mine is disabled.</span>
<span class="term-fg32">+	if ctx.IsSet(RollupSequencerHTTPFlag.Name) &amp;&amp; !ctx.IsSet(MiningEnabledFlag.Name) {</span>
<span class="term-fg32">+		cfg.RollupSequencerHTTP = ctx.String(RollupSequencerHTTPFlag.Name)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if ctx.IsSet(RollupHistoricalRPCFlag.Name) {</span>
<span class="term-fg32">+		cfg.RollupHistoricalRPC = ctx.String(RollupHistoricalRPCFlag.Name)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	cfg.RollupDisableTxPoolGossip = ctx.Bool(RollupDisableTxPoolGossipFlag.Name)</span>
 	&#47;&#47; Override any default configs for hard coded networks.
 	switch {
 	case ctx.Bool(MainnetFlag.Name):</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-90d6b057d97aa307992e459c" role="button"
                   aria-expanded="false" aria-controls="id-90d6b057d97aa307992e459c">
                    <code>consensus/beacon/consensus.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+3</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/consensus/beacon/consensus.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/consensus/beacon/consensus.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-90d6b057d97aa307992e459c"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;beacon&#47;consensus.go op-geth&#47;consensus&#47;beacon&#47;consensus.go</span>
<span class="term-fg1">index 6d108856e6d6cc14f9750dcada42b8a3fc47653d..3152f6399410c6e7787c4956018b1696de676cb4 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;beacon&#47;consensus.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;beacon&#47;consensus.go</span>
<span class="term-fg36">@@ -423,6 +423,9 @@</span> func IsTTDReached(chain consensus.ChainHeaderReader, parentHash common.Hash, number uint64) (bool, error) {
 	if chain.Config().TerminalTotalDifficulty == nil {
 		return false, nil
 	}
<span class="term-fg32">+	if common.Big0.Cmp(chain.Config().TerminalTotalDifficulty) == 0 { &#47;&#47; in case TTD is reached at genesis.</span>
<span class="term-fg32">+		return true, nil</span>
<span class="term-fg32">+	}</span>
 	td := chain.GetTd(parentHash, number)
 	if td == nil {
 		return false, consensus.ErrUnknownAncestor</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e249f2178ac446a58328edcb" role="button"
                   aria-expanded="false" aria-controls="id-e249f2178ac446a58328edcb">
                    <code>consensus/misc/eip1559.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+4</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/consensus/misc/eip1559.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/consensus/misc/eip1559.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e249f2178ac446a58328edcb"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;misc&#47;eip1559.go op-geth&#47;consensus&#47;misc&#47;eip1559.go</span>
<span class="term-fg1">index 4521b47b36e6b4d6fe0aa1c9895383f1be2f3ec1..0b6c8532ac01995cc73a161889a29612b63615e1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;misc&#47;eip1559.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;misc&#47;eip1559.go</span>
<span class="term-fg36">@@ -35,8 +35,10 @@</span> 	parentGasLimit := parent.GasLimit
 	if !config.IsLondon(parent.Number) {
 		parentGasLimit = parent.GasLimit * config.ElasticityMultiplier()
 	}
<span class="term-fg31">-	if err := VerifyGaslimit(parentGasLimit, header.GasLimit); err != nil {</span>
<span class="term-fg31">-		return err</span>
<span class="term-fg32">+	if config.Optimism == nil { &#47;&#47; gasLimit can adjust instantly in optimism</span>
<span class="term-fg32">+		if err := VerifyGaslimit(parentGasLimit, header.GasLimit); err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
 	}
 	&#47;&#47; Verify the header is not malformed
 	if header.BaseFee == nil {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f9da35c1b096759eaa4b413b" role="button"
                   aria-expanded="false" aria-controls="id-f9da35c1b096759eaa4b413b">
                    <code>core/state_prefetcher.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/state_prefetcher.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/state_prefetcher.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f9da35c1b096759eaa4b413b"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state_prefetcher.go op-geth&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg1">index 10a1722940b0e4368baa42172a6a0c8262b18a3b..1a6cee1d3fc0a9e83655ab749cb62a73cd7a63bf 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg36">@@ -55,6 +55,7 @@</span> 		blockContext = NewEVMBlockContext(header, p.bc, nil)
 		evm          = vm.NewEVM(blockContext, vm.TxContext{}, statedb, p.config, cfg)
 		signer       = types.MakeSigner(p.config, header.Number)
 	)
<span class="term-fg32">+	blockContext.L1CostFunc = types.NewL1CostFunc(p.config, statedb)</span>
 	&#47;&#47; Iterate over and process the individual transactions
 	byzantium := p.config.IsByzantium(block.Number())
 	for i, tx := range block.Transactions() {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4cf2c9cdeea9fb9c6a2c408b" role="button"
                   aria-expanded="false" aria-controls="id-4cf2c9cdeea9fb9c6a2c408b">
                    <code>core/state_processor.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+2</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/state_processor.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/state_processor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4cf2c9cdeea9fb9c6a2c408b"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state_processor.go op-geth&#47;core&#47;state_processor.go</span>
<span class="term-fg1">index e511697c5f6af6dbbfc88fc184104573fefbf5d5..81552f4cd24c750710998ef2b9e80b015e4b3197 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state_processor.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state_processor.go</span>
<span class="term-fg36">@@ -71,6 +71,7 @@</span> 	if p.config.DAOForkSupport &amp;&amp; p.config.DAOForkBlock != nil &amp;&amp; p.config.DAOForkBlock.Cmp(block.Number()) == 0 {
 		misc.ApplyDAOHardFork(statedb)
 	}
 	blockContext := NewEVMBlockContext(header, p.bc, nil)
<span class="term-fg32">+	blockContext.L1CostFunc = types.NewL1CostFunc(p.config, statedb)</span>
 	vmenv := vm.NewEVM(blockContext, vm.TxContext{}, statedb, p.config, cfg)
 	&#47;&#47; Iterate over and process the individual transactions
 	for i, tx := range block.Transactions() {
<span class="term-fg36">@@ -148,6 +149,7 @@</span> 		return nil, err
 	}
 	&#47;&#47; Create a new context to be used in the EVM environment
 	blockContext := NewEVMBlockContext(header, bc, author)
<span class="term-fg32">+	blockContext.L1CostFunc = types.NewL1CostFunc(config, statedb)</span>
 	vmenv := vm.NewEVM(blockContext, vm.TxContext{}, statedb, config, cfg)
 	return applyTransaction(msg, config, author, gp, statedb, header.Number, header.Hash(), tx, usedGas, vmenv)
 }</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d7882f9ee595e74a51bf99ae" role="button"
                   aria-expanded="false" aria-controls="id-d7882f9ee595e74a51bf99ae">
                    <code>core/state_transition.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+78</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/state_transition.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/state_transition.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d7882f9ee595e74a51bf99ae"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state_transition.go op-geth&#47;core&#47;state_transition.go</span>
<span class="term-fg1">index e6a15a3c1c2e4ae057633b0c96a89e722f7086ab..3d7107472a113702c92b54507bb681cae01226b7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state_transition.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state_transition.go</span>
<span class="term-fg36">@@ -62,6 +62,7 @@</span> 	gasFeeCap  *big.Int
 	gasTipCap  *big.Int
 	initialGas uint64
 	value      *big.Int
<span class="term-fg32">+	mint       *big.Int</span>
 	data       []byte
 	state      vm.StateDB
 	evm        *vm.EVM
<span class="term-fg36">@@ -77,6 +78,11 @@</span> 	GasFeeCap() *big.Int
 	GasTipCap() *big.Int
 	Gas() uint64
 	Value() *big.Int
<span class="term-fg32">+</span>
<span class="term-fg32">+	IsSystemTx() bool      &#47;&#47; IsSystemTx indicates the message, if also a deposit, does not emit gas usage.</span>
<span class="term-fg32">+	IsDepositTx() bool     &#47;&#47; IsDepositTx indicates the message is force-included and can persist a mint.</span>
<span class="term-fg32">+	Mint() *big.Int        &#47;&#47; Mint is the amount to mint before EVM processing, or nil if there is no minting.</span>
<span class="term-fg32">+	RollupDataGas() uint64 &#47;&#47; RollupDataGas indicates the rollup cost of the message, 0 if not a rollup or no cost.</span>
&nbsp;
 	Nonce() uint64
 	IsFake() bool
<span class="term-fg36">@@ -170,6 +176,7 @@</span> 		gasPrice:  msg.GasPrice(),
 		gasFeeCap: msg.GasFeeCap(),
 		gasTipCap: msg.GasTipCap(),
 		value:     msg.Value(),
<span class="term-fg32">+		mint:      msg.Mint(),</span>
 		data:      msg.Data(),
 		state:     evm.StateDB,
 	}
<span class="term-fg36">@@ -197,11 +204,21 @@</span>
 func (st *StateTransition) buyGas() error {
 	mgval := new(big.Int).SetUint64(st.msg.Gas())
 	mgval = mgval.Mul(mgval, st.gasPrice)
<span class="term-fg32">+	var l1Cost *big.Int</span>
<span class="term-fg32">+	if st.evm.Context.L1CostFunc != nil {</span>
<span class="term-fg32">+		l1Cost = st.evm.Context.L1CostFunc(st.evm.Context.BlockNumber.Uint64(), st.msg)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if l1Cost != nil {</span>
<span class="term-fg32">+		mgval = mgval.Add(mgval, l1Cost)</span>
<span class="term-fg32">+	}</span>
 	balanceCheck := mgval
 	if st.gasFeeCap != nil {
 		balanceCheck = new(big.Int).SetUint64(st.msg.Gas())
 		balanceCheck = balanceCheck.Mul(balanceCheck, st.gasFeeCap)
 		balanceCheck.Add(balanceCheck, st.value)
<span class="term-fg32">+		if l1Cost != nil {</span>
<span class="term-fg32">+			balanceCheck.Add(balanceCheck, l1Cost)</span>
<span class="term-fg32">+		}</span>
 	}
 	if have, want := st.state.GetBalance(st.msg.From()), balanceCheck; have.Cmp(want) &lt; 0 {
 		return fmt.Errorf(&quot;%w: address %v have %v want %v&quot;, ErrInsufficientFunds, st.msg.From().Hex(), have, want)
<span class="term-fg36">@@ -217,6 +234,17 @@</span> 	return nil
 }
&nbsp;
 func (st *StateTransition) preCheck() error {
<span class="term-fg32">+	if st.msg.IsDepositTx() {</span>
<span class="term-fg32">+		&#47;&#47; No fee fields to check, no nonce to check, and no need to check if EOA (L1 already verified it for us)</span>
<span class="term-fg32">+		&#47;&#47; Gas is free, but no refunds!</span>
<span class="term-fg32">+		st.initialGas = st.msg.Gas()</span>
<span class="term-fg32">+		st.gas += st.msg.Gas() &#47;&#47; Add gas here in order to be able to execute calls.</span>
<span class="term-fg32">+		&#47;&#47; Don&#39;t touch the gas pool for system transactions</span>
<span class="term-fg32">+		if st.msg.IsSystemTx() {</span>
<span class="term-fg32">+			return nil</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return st.gp.SubGas(st.msg.Gas()) &#47;&#47; gas used by deposits may not be used by other txs</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Only check transactions that are not fake
 	if !st.msg.IsFake() {
 		&#47;&#47; Make sure this transaction&#39;s nonce is correct.
<span class="term-fg36">@@ -275,6 +303,35 @@</span> &#47;&#47;
 &#47;&#47; However if any consensus issue encountered, return the error directly with
 &#47;&#47; nil evm execution result.
 func (st *StateTransition) TransitionDb() (*ExecutionResult, error) {
<span class="term-fg32">+	if mint := st.msg.Mint(); mint != nil {</span>
<span class="term-fg32">+		st.state.AddBalance(st.msg.From(), mint)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	snap := st.state.Snapshot()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	result, err := st.innerTransitionDb()</span>
<span class="term-fg32">+	&#47;&#47; Failed deposits must still be included. Unless we cannot produce the block at all due to the gas limit.</span>
<span class="term-fg32">+	&#47;&#47; On deposit failure, we rewind any state changes from after the minting, and increment the nonce.</span>
<span class="term-fg32">+	if err != nil &amp;&amp; err != ErrGasLimitReached &amp;&amp; st.msg.IsDepositTx() {</span>
<span class="term-fg32">+		st.state.RevertToSnapshot(snap)</span>
<span class="term-fg32">+		&#47;&#47; Even though we revert the state changes, always increment the nonce for the next deposit transaction</span>
<span class="term-fg32">+		st.state.SetNonce(st.msg.From(), st.state.GetNonce(st.msg.From())+1)</span>
<span class="term-fg32">+		&#47;&#47; Record deposits as using all their gas (matches the gas pool)</span>
<span class="term-fg32">+		&#47;&#47; System Transactions are special &amp; are not recorded as using any gas (anywhere)</span>
<span class="term-fg32">+		gasUsed := st.msg.Gas()</span>
<span class="term-fg32">+		if st.msg.IsSystemTx() {</span>
<span class="term-fg32">+			gasUsed = 0</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		result = &amp;ExecutionResult{</span>
<span class="term-fg32">+			UsedGas:    gasUsed,</span>
<span class="term-fg32">+			Err:        fmt.Errorf(&quot;failed deposit: %w&quot;, err),</span>
<span class="term-fg32">+			ReturnData: nil,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		err = nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return result, err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (st *StateTransition) innerTransitionDb() (*ExecutionResult, error) {</span>
 	&#47;&#47; First check this message satisfies all consensus rules before
 	&#47;&#47; applying the message. The rules include these clauses
 	&#47;&#47;
<span class="term-fg36">@@ -335,6 +392,20 @@</span> 		st.state.SetNonce(msg.From(), st.state.GetNonce(sender.Address())+1)
 		ret, st.gas, vmerr = st.evm.Call(sender, st.to(), st.data, st.gas, st.value)
 	}
&nbsp;
<span class="term-fg32">+	&#47;&#47; if deposit: skip refunds, skip tipping coinbase</span>
<span class="term-fg32">+	if st.msg.IsDepositTx() {</span>
<span class="term-fg32">+		&#47;&#47; Record deposits as using all their gas (matches the gas pool)</span>
<span class="term-fg32">+		&#47;&#47; System Transactions are special &amp; are not recorded as using any gas (anywhere)</span>
<span class="term-fg32">+		gasUsed := st.msg.Gas()</span>
<span class="term-fg32">+		if st.msg.IsSystemTx() {</span>
<span class="term-fg32">+			gasUsed = 0</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return &amp;ExecutionResult{</span>
<span class="term-fg32">+			UsedGas:    gasUsed,</span>
<span class="term-fg32">+			Err:        vmerr,</span>
<span class="term-fg32">+			ReturnData: ret,</span>
<span class="term-fg32">+		}, nil</span>
<span class="term-fg32">+	}</span>
 	if !rules.IsLondon {
 		&#47;&#47; Before EIP-3529: refunds were capped to gasUsed &#47; 2
 		st.refundGas(params.RefundQuotient)
<span class="term-fg36">@@ -355,6 +426,13 @@</span> 	} else {
 		fee := new(big.Int).SetUint64(st.gasUsed())
 		fee.Mul(fee, effectiveTip)
 		st.state.AddBalance(st.evm.Context.Coinbase, fee)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if optimismConfig := st.evm.ChainConfig().Optimism; optimismConfig != nil {</span>
<span class="term-fg32">+		st.state.AddBalance(params.OptimismBaseFeeRecipient, new(big.Int).Mul(new(big.Int).SetUint64(st.gasUsed()), st.evm.Context.BaseFee))</span>
<span class="term-fg32">+		if cost := st.evm.Context.L1CostFunc(st.evm.Context.BlockNumber.Uint64(), st.msg); cost != nil {</span>
<span class="term-fg32">+			st.state.AddBalance(params.OptimismL1FeeRecipient, cost)</span>
<span class="term-fg32">+		}</span>
 	}
&nbsp;
 	return &amp;ExecutionResult{</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-026c6b8085cf4e64f6ac8aa6" role="button"
                   aria-expanded="false" aria-controls="id-026c6b8085cf4e64f6ac8aa6">
                    <code>core/txpool/txpool.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+44</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/txpool/txpool.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/txpool/txpool.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-026c6b8085cf4e64f6ac8aa6"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;txpool&#47;txpool.go op-geth&#47;core&#47;txpool&#47;txpool.go</span>
<span class="term-fg1">index 8905140fdb69d274ce899dc7dc86fdb301dae117..8cce45941f482d5035781d8123c0ffe9f6a625f1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;txpool&#47;txpool.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;txpool&#47;txpool.go</span>
<span class="term-fg36">@@ -250,6 +250,8 @@</span> 	currentState  *state.StateDB &#47;&#47; Current state in the blockchain head
 	pendingNonces *noncer        &#47;&#47; Pending state tracking virtual nonces
 	currentMaxGas uint64         &#47;&#47; Current gas limit for transaction caps
&nbsp;
<span class="term-fg32">+	l1CostFn func(message types.RollupMessage) *big.Int &#47;&#47; Current L1 fee cost function</span>
<span class="term-fg32">+</span>
 	locals  *accountSet &#47;&#47; Set of local transaction to exempt from eviction rules
 	journal *journal    &#47;&#47; Journal of local transaction to back up to disk
&nbsp;
<span class="term-fg36">@@ -586,6 +588,12 @@</span>
 &#47;&#47; validateTx checks whether a transaction is valid according to the consensus
 &#47;&#47; rules and adheres to some heuristic limits of the local node (price and size).
 func (pool *TxPool) validateTx(tx *types.Transaction, local bool) error {
<span class="term-fg32">+	&#47;&#47; No unauthenticated deposits allowed in the transaction pool.</span>
<span class="term-fg32">+	&#47;&#47; This is for spam protection, not consensus,</span>
<span class="term-fg32">+	&#47;&#47; as the external engine-API user authenticates deposits.</span>
<span class="term-fg32">+	if tx.Type() == types.DepositTxType {</span>
<span class="term-fg32">+		return core.ErrTxTypeNotSupported</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Accept only legacy transactions until EIP-2718&#47;2930 activates.
 	if !pool.eip2718 &amp;&amp; tx.Type() != types.LegacyTxType {
 		return core.ErrTxTypeNotSupported
<span class="term-fg36">@@ -633,7 +641,11 @@</span> 		return core.ErrNonceTooLow
 	}
 	&#47;&#47; Transactor should have enough funds to cover the costs
 	&#47;&#47; cost == V + GP * GL
<span class="term-fg31">-	if pool.currentState.GetBalance(from).Cmp(tx.Cost()) &lt; 0 {</span>
<span class="term-fg32">+	cost := tx.Cost()</span>
<span class="term-fg32">+	if l1Cost := pool.l1CostFn(tx); l1Cost != nil { &#47;&#47; add rollup cost</span>
<span class="term-fg32">+		cost = cost.Add(cost, l1Cost)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if pool.currentState.GetBalance(from).Cmp(cost) &lt; 0 {</span>
 		return core.ErrInsufficientFunds
 	}
 	&#47;&#47; Ensure the transaction has more gas than the basic tx fee.
<span class="term-fg36">@@ -1279,6 +1291,16 @@</span> 						log.Error(&quot;Unrooted new chain seen by tx pool&quot;, &quot;block&quot;, newHead.Number, &quot;hash&quot;, newHead.Hash())
 						return
 					}
 				}
<span class="term-fg32">+				&#47;&#47; Do not insert deposit txs back into the pool</span>
<span class="term-fg32">+				&#47;&#47; (validateTx would still catch it if not filtered, but no need to re-inject in the first place).</span>
<span class="term-fg32">+				j := 0</span>
<span class="term-fg32">+				for _, tx := range discarded {</span>
<span class="term-fg32">+					if tx.Type() != types.DepositTxType {</span>
<span class="term-fg32">+						discarded[j] = tx</span>
<span class="term-fg32">+						j++</span>
<span class="term-fg32">+					}</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				discarded = discarded[:j]</span>
 				reinject = types.TxDifference(discarded, included)
 			}
 		}
<span class="term-fg36">@@ -1296,6 +1318,11 @@</span> 	pool.currentState = statedb
 	pool.pendingNonces = newNoncer(statedb)
 	pool.currentMaxGas = newHead.GasLimit
&nbsp;
<span class="term-fg32">+	costFn := types.NewL1CostFunc(pool.chainconfig, statedb)</span>
<span class="term-fg32">+	pool.l1CostFn = func(message types.RollupMessage) *big.Int {</span>
<span class="term-fg32">+		return costFn(newHead.Number.Uint64(), message)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Inject any transactions discarded due to reorgs
 	log.Debug(&quot;Reinjecting stale transactions&quot;, &quot;count&quot;, len(reinject))
 	core.SenderCacher.Recover(pool.signer, reinject)
<span class="term-fg36">@@ -1328,8 +1355,15 @@</span> 			hash := tx.Hash()
 			pool.all.Remove(hash)
 		}
 		log.Trace(&quot;Removed old queued transactions&quot;, &quot;count&quot;, len(forwards))
<span class="term-fg32">+		balance := pool.currentState.GetBalance(addr)</span>
<span class="term-fg32">+		if !list.Empty() {</span>
<span class="term-fg32">+			&#47;&#47; Reduce the cost-cap by L1 rollup cost of the first tx if necessary. Other txs will get filtered out afterwards.</span>
<span class="term-fg32">+			if l1Cost := pool.l1CostFn(list.txs.FirstElement()); l1Cost != nil {</span>
<span class="term-fg32">+				balance = new(big.Int).Sub(balance, l1Cost) &#47;&#47; negative big int is fine</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; Drop all transactions that are too costly (low balance or out of gas)
<span class="term-fg31">-		drops, _ := list.Filter(pool.currentState.GetBalance(addr), pool.currentMaxGas)</span>
<span class="term-fg32">+		drops, _ := list.Filter(balance, pool.currentMaxGas)</span>
 		for _, tx := range drops {
 			hash := tx.Hash()
 			pool.all.Remove(hash)
<span class="term-fg36">@@ -1525,8 +1559,15 @@</span> 			hash := tx.Hash()
 			pool.all.Remove(hash)
 			log.Trace(&quot;Removed old pending transaction&quot;, &quot;hash&quot;, hash)
 		}
<span class="term-fg32">+		balance := pool.currentState.GetBalance(addr)</span>
<span class="term-fg32">+		if !list.Empty() {</span>
<span class="term-fg32">+			&#47;&#47; Reduce the cost-cap by L1 rollup cost of the first tx if necessary. Other txs will get filtered out afterwards.</span>
<span class="term-fg32">+			if l1Cost := pool.l1CostFn(list.txs.FirstElement()); l1Cost != nil {</span>
<span class="term-fg32">+				balance = new(big.Int).Sub(balance, l1Cost) &#47;&#47; negative big int is fine</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; Drop all transactions that are too costly (low balance or out of gas), and queue any invalids back for later
<span class="term-fg31">-		drops, invalids := list.Filter(pool.currentState.GetBalance(addr), pool.currentMaxGas)</span>
<span class="term-fg32">+		drops, invalids := list.Filter(balance, pool.currentMaxGas)</span>
 		for _, tx := range drops {
 			hash := tx.Hash()
 			log.Trace(&quot;Removed unpayable pending transaction&quot;, &quot;hash&quot;, hash)</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-81cd30ebd11f80e3982d22bd" role="button"
                   aria-expanded="false" aria-controls="id-81cd30ebd11f80e3982d22bd">
                    <code>core/types/deposit_tx.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+87</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/deposit_tx.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-81cd30ebd11f80e3982d22bd"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;deposit_tx.go op-geth&#47;core&#47;types&#47;deposit_tx.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..698e4b327e702dcd9f74fabae155dd1a364a233e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;deposit_tx.go</span>
<span class="term-fg36">@@ -0,0 +1,87 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2021 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const DepositTxType = 0x7E</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type DepositTx struct {</span>
<span class="term-fg32">+	&#47;&#47; SourceHash uniquely identifies the source of the deposit</span>
<span class="term-fg32">+	SourceHash common.Hash</span>
<span class="term-fg32">+	&#47;&#47; From is exposed through the types.Signer, not through TxData</span>
<span class="term-fg32">+	From common.Address</span>
<span class="term-fg32">+	&#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	To *common.Address `rlp:&quot;nil&quot;`</span>
<span class="term-fg32">+	&#47;&#47; Mint is minted on L2, locked on L1, nil if no minting.</span>
<span class="term-fg32">+	Mint *big.Int `rlp:&quot;nil&quot;`</span>
<span class="term-fg32">+	&#47;&#47; Value is transferred from L2 balance, executed after Mint (if any)</span>
<span class="term-fg32">+	Value *big.Int</span>
<span class="term-fg32">+	&#47;&#47; gas limit</span>
<span class="term-fg32">+	Gas uint64</span>
<span class="term-fg32">+	&#47;&#47; Field indicating if this transaction is exempt from the L2 gas limit.</span>
<span class="term-fg32">+	IsSystemTransaction bool</span>
<span class="term-fg32">+	&#47;&#47; Normal Tx data</span>
<span class="term-fg32">+	Data []byte</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; copy creates a deep copy of the transaction data and initializes all fields.</span>
<span class="term-fg32">+func (tx *DepositTx) copy() TxData {</span>
<span class="term-fg32">+	cpy := &amp;DepositTx{</span>
<span class="term-fg32">+		SourceHash:          tx.SourceHash,</span>
<span class="term-fg32">+		From:                tx.From,</span>
<span class="term-fg32">+		To:                  copyAddressPtr(tx.To),</span>
<span class="term-fg32">+		Mint:                nil,</span>
<span class="term-fg32">+		Value:               new(big.Int),</span>
<span class="term-fg32">+		Gas:                 tx.Gas,</span>
<span class="term-fg32">+		IsSystemTransaction: tx.IsSystemTransaction,</span>
<span class="term-fg32">+		Data:                common.CopyBytes(tx.Data),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.Mint != nil {</span>
<span class="term-fg32">+		cpy.Mint = new(big.Int).Set(tx.Mint)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.Value != nil {</span>
<span class="term-fg32">+		cpy.Value.Set(tx.Value)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return cpy</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; accessors for innerTx.</span>
<span class="term-fg32">+func (tx *DepositTx) txType() byte           { return DepositTxType }</span>
<span class="term-fg32">+func (tx *DepositTx) chainID() *big.Int      { return common.Big0 }</span>
<span class="term-fg32">+func (tx *DepositTx) accessList() AccessList { return nil }</span>
<span class="term-fg32">+func (tx *DepositTx) data() []byte           { return tx.Data }</span>
<span class="term-fg32">+func (tx *DepositTx) gas() uint64            { return tx.Gas }</span>
<span class="term-fg32">+func (tx *DepositTx) gasFeeCap() *big.Int    { return new(big.Int) }</span>
<span class="term-fg32">+func (tx *DepositTx) gasTipCap() *big.Int    { return new(big.Int) }</span>
<span class="term-fg32">+func (tx *DepositTx) gasPrice() *big.Int     { return new(big.Int) }</span>
<span class="term-fg32">+func (tx *DepositTx) value() *big.Int        { return tx.Value }</span>
<span class="term-fg32">+func (tx *DepositTx) nonce() uint64          { return 0 }</span>
<span class="term-fg32">+func (tx *DepositTx) to() *common.Address    { return tx.To }</span>
<span class="term-fg32">+func (tx *DepositTx) isSystemTx() bool       { return tx.IsSystemTransaction }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *DepositTx) rawSignatureValues() (v, r, s *big.Int) {</span>
<span class="term-fg32">+	return common.Big0, common.Big0, common.Big0</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *DepositTx) setSignatureValues(chainID, v, r, s *big.Int) {</span>
<span class="term-fg32">+	&#47;&#47; this is a noop for deposit transactions</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4c9f90f66cb78372e4c6fe98" role="button"
                   aria-expanded="false" aria-controls="id-4c9f90f66cb78372e4c6fe98">
                    <code>core/types/gen_receipt_json.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+24</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/gen_receipt_json.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/gen_receipt_json.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4c9f90f66cb78372e4c6fe98"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;gen_receipt_json.go op-geth&#47;core&#47;types&#47;gen_receipt_json.go</span>
<span class="term-fg1">index bb892f85bec8cbfe34d3896a8075990bc6c51d61..a506116f33a077effb4c3200c42b7a1ed72b4f73 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;gen_receipt_json.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;gen_receipt_json.go</span>
<span class="term-fg36">@@ -28,6 +28,10 @@</span> 		GasUsed           hexutil.Uint64 `json:&quot;gasUsed&quot; gencodec:&quot;required&quot;`
 		BlockHash         common.Hash    `json:&quot;blockHash,omitempty&quot;`
 		BlockNumber       *hexutil.Big   `json:&quot;blockNumber,omitempty&quot;`
 		TransactionIndex  hexutil.Uint   `json:&quot;transactionIndex&quot;`
<span class="term-fg32">+		L1GasPrice        *hexutil.Big   `json:&quot;l1GasPrice,omitempty&quot;`</span>
<span class="term-fg32">+		L1GasUsed         *hexutil.Big   `json:&quot;l1GasUsed,omitempty&quot;`</span>
<span class="term-fg32">+		L1Fee             *hexutil.Big   `json:&quot;l1Fee,omitempty&quot;`</span>
<span class="term-fg32">+		FeeScalar         *big.Float     `json:&quot;l1FeeScalar,omitempty&quot;`</span>
 	}
 	var enc Receipt
 	enc.Type = hexutil.Uint64(r.Type)
<span class="term-fg36">@@ -42,6 +46,10 @@</span> 	enc.GasUsed = hexutil.Uint64(r.GasUsed)
 	enc.BlockHash = r.BlockHash
 	enc.BlockNumber = (*hexutil.Big)(r.BlockNumber)
 	enc.TransactionIndex = hexutil.Uint(r.TransactionIndex)
<span class="term-fg32">+	enc.L1GasPrice = (*hexutil.Big)(r.L1GasPrice)</span>
<span class="term-fg32">+	enc.L1GasUsed = (*hexutil.Big)(r.L1GasUsed)</span>
<span class="term-fg32">+	enc.L1Fee = (*hexutil.Big)(r.L1Fee)</span>
<span class="term-fg32">+	enc.FeeScalar = r.FeeScalar</span>
 	return json.Marshal(&amp;enc)
 }
&nbsp;
<span class="term-fg36">@@ -60,6 +68,10 @@</span> 		GasUsed           *hexutil.Uint64 `json:&quot;gasUsed&quot; gencodec:&quot;required&quot;`
 		BlockHash         *common.Hash    `json:&quot;blockHash,omitempty&quot;`
 		BlockNumber       *hexutil.Big    `json:&quot;blockNumber,omitempty&quot;`
 		TransactionIndex  *hexutil.Uint   `json:&quot;transactionIndex&quot;`
<span class="term-fg32">+		L1GasPrice        *hexutil.Big    `json:&quot;l1GasPrice,omitempty&quot;`</span>
<span class="term-fg32">+		L1GasUsed         *hexutil.Big    `json:&quot;l1GasUsed,omitempty&quot;`</span>
<span class="term-fg32">+		L1Fee             *hexutil.Big    `json:&quot;l1Fee,omitempty&quot;`</span>
<span class="term-fg32">+		FeeScalar         *big.Float      `json:&quot;l1FeeScalar,omitempty&quot;`</span>
 	}
 	var dec Receipt
 	if err := json.Unmarshal(input, &amp;dec); err != nil {
<span class="term-fg36">@@ -105,6 +117,18 @@</span> 		r.BlockNumber = (*big.Int)(dec.BlockNumber)
 	}
 	if dec.TransactionIndex != nil {
 		r.TransactionIndex = uint(*dec.TransactionIndex)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.L1GasPrice != nil {</span>
<span class="term-fg32">+		r.L1GasPrice = (*big.Int)(dec.L1GasPrice)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.L1GasUsed != nil {</span>
<span class="term-fg32">+		r.L1GasUsed = (*big.Int)(dec.L1GasUsed)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.L1Fee != nil {</span>
<span class="term-fg32">+		r.L1Fee = (*big.Int)(dec.L1Fee)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.FeeScalar != nil {</span>
<span class="term-fg32">+		r.FeeScalar = dec.FeeScalar</span>
 	}
 	return nil
 }</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-eeaef5435c13cb9d7d6895e2" role="button"
                   aria-expanded="false" aria-controls="id-eeaef5435c13cb9d7d6895e2">
                    <code>core/types/transaction.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+90</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/transaction.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/transaction.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-eeaef5435c13cb9d7d6895e2"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;transaction.go op-geth&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg1">index 910c68aea363a606bcad823fb8ba892462c5df7a..9e4fbb6ba116dd41ee4d752d6e028c7fc94a2808 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg36">@@ -28,6 +28,8 @@</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 )
&nbsp;
<span class="term-fg36">@@ -56,6 +58,9 @@</span> 	&#47;&#47; caches
 	hash atomic.Value
 	size atomic.Value
 	from atomic.Value
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; cache how much gas the tx takes on L1 for its share of rollup data</span>
<span class="term-fg32">+	rollupGas atomic.Value</span>
 }
&nbsp;
 &#47;&#47; NewTx creates a new transaction.
<span class="term-fg36">@@ -82,6 +87,7 @@</span> 	gasFeeCap() *big.Int
 	value() *big.Int
 	nonce() uint64
 	to() *common.Address
<span class="term-fg32">+	isSystemTx() bool</span>
&nbsp;
 	rawSignatureValues() (v, r, s *big.Int)
 	setSignatureValues(chainID, v, r, s *big.Int)
<span class="term-fg36">@@ -184,6 +190,10 @@</span> 	case DynamicFeeTxType:
 		var inner DynamicFeeTx
 		err := rlp.DecodeBytes(b[1:], &amp;inner)
 		return &amp;inner, err
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		var inner DepositTx</span>
<span class="term-fg32">+		err := rlp.DecodeBytes(b[1:], &amp;inner)</span>
<span class="term-fg32">+		return &amp;inner, err</span>
 	default:
 		return nil, ErrTxTypeNotSupported
 	}
<span class="term-fg36">@@ -285,6 +295,36 @@</span> func (tx *Transaction) To() *common.Address {
 	return copyAddressPtr(tx.inner.to())
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; SourceHash returns the hash that uniquely identifies the source of the deposit tx,</span>
<span class="term-fg32">+&#47;&#47; e.g. a user deposit event, or a L1 info deposit included in a specific L2 block height.</span>
<span class="term-fg32">+&#47;&#47; Non-deposit transactions return a zeroed hash.</span>
<span class="term-fg32">+func (tx *Transaction) SourceHash() common.Hash {</span>
<span class="term-fg32">+	if dep, ok := tx.inner.(*DepositTx); ok {</span>
<span class="term-fg32">+		return dep.SourceHash</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return common.Hash{}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Mint returns the ETH to mint in the deposit tx.</span>
<span class="term-fg32">+&#47;&#47; This returns nil if there is nothing to mint, or if this is not a deposit tx.</span>
<span class="term-fg32">+func (tx *Transaction) Mint() *big.Int {</span>
<span class="term-fg32">+	if dep, ok := tx.inner.(*DepositTx); ok {</span>
<span class="term-fg32">+		return dep.Mint</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsDepositTx returns true if the transaction is a deposit tx type.</span>
<span class="term-fg32">+func (tx *Transaction) IsDepositTx() bool {</span>
<span class="term-fg32">+	return tx.Type() == DepositTxType</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsSystemTx returns true for deposits that are system transactions. These transactions</span>
<span class="term-fg32">+&#47;&#47; are executed in an unmetered environment &amp; do not contribute to the block gas limit.</span>
<span class="term-fg32">+func (tx *Transaction) IsSystemTx() bool {</span>
<span class="term-fg32">+	return tx.inner.isSystemTx()</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; Cost returns gas * gasPrice + value.
 func (tx *Transaction) Cost() *big.Int {
 	total := new(big.Int).Mul(tx.GasPrice(), new(big.Int).SetUint64(tx.Gas()))
<span class="term-fg36">@@ -292,6 +332,34 @@</span> 	total.Add(total, tx.Value())
 	return total
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; RollupDataGas is the amount of gas it takes to confirm the tx on L1 as a rollup</span>
<span class="term-fg32">+func (tx *Transaction) RollupDataGas() uint64 {</span>
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return 0</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if v := tx.rollupGas.Load(); v != nil {</span>
<span class="term-fg32">+		return v.(uint64)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	data, err := tx.MarshalBinary()</span>
<span class="term-fg32">+	if err != nil { &#47;&#47; Silent error, invalid txs will not be marshalled&#47;unmarshalled for batch submission anyway.</span>
<span class="term-fg32">+		log.Error(&quot;failed to encode tx for L1 cost computation&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var zeroes uint64</span>
<span class="term-fg32">+	var ones uint64</span>
<span class="term-fg32">+	for _, byt := range data {</span>
<span class="term-fg32">+		if byt == 0 {</span>
<span class="term-fg32">+			zeroes++</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			ones++</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	zeroesGas := zeroes * params.TxDataZeroGas</span>
<span class="term-fg32">+	onesGas := (ones + 68) * params.TxDataNonZeroGasEIP2028</span>
<span class="term-fg32">+	total := zeroesGas + onesGas</span>
<span class="term-fg32">+	tx.rollupGas.Store(total)</span>
<span class="term-fg32">+	return total</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; RawSignatureValues returns the V, R, S signature values of the transaction.
 &#47;&#47; The return values should not be modified by the caller.
 func (tx *Transaction) RawSignatureValues() (v, r, s *big.Int) {
<span class="term-fg36">@@ -322,6 +390,9 @@</span> &#47;&#47; EffectiveGasTip returns the effective miner gasTipCap for the given base fee.
 &#47;&#47; Note: if the effective gasTipCap is negative, this method returns both error
 &#47;&#47; the actual negative value, _and_ ErrGasFeeCapTooLow
 func (tx *Transaction) EffectiveGasTip(baseFee *big.Int) (*big.Int, error) {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return new(big.Int), nil</span>
<span class="term-fg32">+	}</span>
 	if baseFee == nil {
 		return tx.GasTipCap(), nil
 	}
<span class="term-fg36">@@ -595,6 +666,11 @@</span> 	gasTipCap  *big.Int
 	data       []byte
 	accessList AccessList
 	isFake     bool
<span class="term-fg32">+	&#47;&#47; Optimism rollup fields</span>
<span class="term-fg32">+	isSystemTx  bool</span>
<span class="term-fg32">+	isDepositTx bool</span>
<span class="term-fg32">+	mint        *big.Int</span>
<span class="term-fg32">+	l1CostGas   uint64</span>
 }
&nbsp;
 func NewMessage(from common.Address, to *common.Address, nonce uint64, amount *big.Int, gasLimit uint64, gasPrice, gasFeeCap, gasTipCap *big.Int, data []byte, accessList AccessList, isFake bool) Message {
<span class="term-fg36">@@ -610,6 +686,11 @@</span> 		gasTipCap:  gasTipCap,
 		data:       data,
 		accessList: accessList,
 		isFake:     isFake,
<span class="term-fg32">+		&#47;&#47; Optimism rollup fields</span>
<span class="term-fg32">+		isSystemTx:  false,</span>
<span class="term-fg32">+		isDepositTx: false,</span>
<span class="term-fg32">+		mint:        nil,</span>
<span class="term-fg32">+		l1CostGas:   0,</span>
 	}
 }
&nbsp;
<span class="term-fg36">@@ -626,6 +707,11 @@</span> 		amount:     tx.Value(),
 		data:       tx.Data(),
 		accessList: tx.AccessList(),
 		isFake:     false,
<span class="term-fg32">+		&#47;&#47; Optimism rollup fields</span>
<span class="term-fg32">+		isSystemTx:  tx.inner.isSystemTx(),</span>
<span class="term-fg32">+		isDepositTx: tx.IsDepositTx(),</span>
<span class="term-fg32">+		mint:        tx.Mint(),</span>
<span class="term-fg32">+		l1CostGas:   tx.RollupDataGas(),</span>
 	}
 	&#47;&#47; If baseFee provided, set gasPrice to effectiveGasPrice.
 	if baseFee != nil {
<span class="term-fg36">@@ -647,6 +733,10 @@</span> func (m Message) Nonce() uint64          { return m.nonce }
 func (m Message) Data() []byte           { return m.data }
 func (m Message) AccessList() AccessList { return m.accessList }
 func (m Message) IsFake() bool           { return m.isFake }
<span class="term-fg32">+func (m Message) IsSystemTx() bool       { return m.isSystemTx }</span>
<span class="term-fg32">+func (m Message) IsDepositTx() bool      { return m.isDepositTx }</span>
<span class="term-fg32">+func (m Message) Mint() *big.Int         { return m.mint }</span>
<span class="term-fg32">+func (m Message) RollupDataGas() uint64  { return m.l1CostGas }</span>
&nbsp;
 &#47;&#47; copyAddressPtr copies an address.
 func copyAddressPtr(a *common.Address) *common.Address {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4d6f3d9f4f1129a878aed711" role="button"
                   aria-expanded="false" aria-controls="id-4d6f3d9f4f1129a878aed711">
                    <code>core/types/transaction_marshalling.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+51</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/transaction_marshalling.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/transaction_marshalling.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4d6f3d9f4f1129a878aed711"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;transaction_marshalling.go op-geth&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg1">index 2566d0b8d6566aa2953cb0456ede19af069e7d4c..ea36a8a63868abb184ef36bb6d091e287f476fe7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg36">@@ -42,6 +42,12 @@</span> 	R                    *hexutil.Big    `json:&quot;r&quot;`
 	S                    *hexutil.Big    `json:&quot;s&quot;`
 	To                   *common.Address `json:&quot;to&quot;`
&nbsp;
<span class="term-fg32">+	&#47;&#47; Deposit transaction fields</span>
<span class="term-fg32">+	SourceHash *common.Hash    `json:&quot;sourceHash,omitempty&quot;`</span>
<span class="term-fg32">+	From       *common.Address `json:&quot;from,omitempty&quot;`</span>
<span class="term-fg32">+	Mint       *hexutil.Big    `json:&quot;mint,omitempty&quot;`</span>
<span class="term-fg32">+	IsSystemTx *bool           `json:&quot;isSystemTx,omitempty&quot;`</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Access list transaction fields:
 	ChainID    *hexutil.Big `json:&quot;chainId,omitempty&quot;`
 	AccessList *AccessList  `json:&quot;accessList,omitempty&quot;`
<span class="term-fg36">@@ -94,6 +100,18 @@</span> 		enc.To = tx.To()
 		enc.V = (*hexutil.Big)(itx.V)
 		enc.R = (*hexutil.Big)(itx.R)
 		enc.S = (*hexutil.Big)(itx.S)
<span class="term-fg32">+	case *DepositTx:</span>
<span class="term-fg32">+		enc.Gas = (*hexutil.Uint64)(&amp;itx.Gas)</span>
<span class="term-fg32">+		enc.Value = (*hexutil.Big)(itx.Value)</span>
<span class="term-fg32">+		enc.Data = (*hexutil.Bytes)(&amp;itx.Data)</span>
<span class="term-fg32">+		enc.To = tx.To()</span>
<span class="term-fg32">+		enc.SourceHash = &amp;itx.SourceHash</span>
<span class="term-fg32">+		enc.From = &amp;itx.From</span>
<span class="term-fg32">+		if itx.Mint != nil {</span>
<span class="term-fg32">+			enc.Mint = (*hexutil.Big)(itx.Mint)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		enc.IsSystemTx = &amp;itx.IsSystemTransaction</span>
<span class="term-fg32">+		&#47;&#47; other fields will show up as null.</span>
 	}
 	return json.Marshal(&amp;enc)
 }
<span class="term-fg36">@@ -262,7 +280,39 @@</span> 			if err := sanityCheckSignature(itx.V, itx.R, itx.S, false); err != nil {
 				return err
 			}
 		}
<span class="term-fg31">-</span>
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		if dec.AccessList != nil || dec.V != nil || dec.R != nil || dec.S != nil || dec.MaxFeePerGas != nil ||</span>
<span class="term-fg32">+			dec.MaxPriorityFeePerGas != nil || dec.GasPrice != nil || (dec.Nonce != nil &amp;&amp; *dec.Nonce != 0) {</span>
<span class="term-fg32">+			return errors.New(&quot;unexpected field(s) in deposit transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		var itx DepositTx</span>
<span class="term-fg32">+		inner = &amp;itx</span>
<span class="term-fg32">+		if dec.To != nil {</span>
<span class="term-fg32">+			itx.To = dec.To</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Gas = uint64(*dec.Gas)</span>
<span class="term-fg32">+		if dec.Value == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;value&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Value = (*big.Int)(dec.Value)</span>
<span class="term-fg32">+		&#47;&#47; mint may be omitted or nil if there is nothing to mint.</span>
<span class="term-fg32">+		itx.Mint = (*big.Int)(dec.Mint)</span>
<span class="term-fg32">+		if dec.Data == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;input&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Data = *dec.Data</span>
<span class="term-fg32">+		if dec.From == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;from&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.From = *dec.From</span>
<span class="term-fg32">+		if dec.SourceHash == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;sourceHash&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.SourceHash = *dec.SourceHash</span>
<span class="term-fg32">+		&#47;&#47; IsSystemTx may be omitted. Defaults to false.</span>
<span class="term-fg32">+		if dec.IsSystemTx != nil {</span>
<span class="term-fg32">+			itx.IsSystemTransaction = *dec.IsSystemTx</span>
<span class="term-fg32">+		}</span>
 	default:
 		return ErrTxTypeNotSupported
 	}</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b504d161a65c7729b613b9d9" role="button"
                   aria-expanded="false" aria-controls="id-b504d161a65c7729b613b9d9">
                    <code>core/types/transaction_signing.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+9</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/transaction_signing.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/transaction_signing.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b504d161a65c7729b613b9d9"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;transaction_signing.go op-geth&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg1">index 87f0390a6f9ce448873688ef214fc02753856342..70a10eb1c1ed086a4421914f940555e406040c55 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg36">@@ -182,6 +182,9 @@</span> 	return londonSigner{eip2930Signer{NewEIP155Signer(chainId)}}
 }
&nbsp;
 func (s londonSigner) Sender(tx *Transaction) (common.Address, error) {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return tx.inner.(*DepositTx).From, nil</span>
<span class="term-fg32">+	}</span>
 	if tx.Type() != DynamicFeeTxType {
 		return s.eip2930Signer.Sender(tx)
 	}
<span class="term-fg36">@@ -201,6 +204,9 @@</span> 	return ok &amp;&amp; x.chainId.Cmp(s.chainId) == 0
 }
&nbsp;
 func (s londonSigner) SignatureValues(tx *Transaction, sig []byte) (R, S, V *big.Int, err error) {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return nil, nil, nil, fmt.Errorf(&quot;deposits do not have a signature&quot;)</span>
<span class="term-fg32">+	}</span>
 	txdata, ok := tx.inner.(*DynamicFeeTx)
 	if !ok {
 		return s.eip2930Signer.SignatureValues(tx, sig)
<span class="term-fg36">@@ -218,6 +224,9 @@</span>
 &#47;&#47; Hash returns the hash to be signed by the sender.
 &#47;&#47; It does not uniquely identify the transaction.
 func (s londonSigner) Hash(tx *Transaction) common.Hash {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		panic(&quot;deposits cannot be signed and do not have a signing hash&quot;)</span>
<span class="term-fg32">+	}</span>
 	if tx.Type() != DynamicFeeTxType {
 		return s.eip2930Signer.Hash(tx)
 	}</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-07a7c906fe44e63cc1f1185a" role="button"
                   aria-expanded="false" aria-controls="id-07a7c906fe44e63cc1f1185a">
                    <code>core/types/tx_legacy.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/types/tx_legacy.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/types/tx_legacy.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-07a7c906fe44e63cc1f1185a"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;tx_legacy.go op-geth&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg1">index 14d307829cc92be9910e78ddde6d65ca8c2c9b03..978e69f2dca7d4db6e5163878714d7199e01a96e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg36">@@ -102,6 +102,7 @@</span> func (tx *LegacyTx) gasFeeCap() *big.Int    { return tx.GasPrice }
 func (tx *LegacyTx) value() *big.Int        { return tx.Value }
 func (tx *LegacyTx) nonce() uint64          { return tx.Nonce }
 func (tx *LegacyTx) to() *common.Address    { return tx.To }
<span class="term-fg32">+func (tx *LegacyTx) isSystemTx() bool       { return false }</span>
&nbsp;
 func (tx *LegacyTx) rawSignatureValues() (v, r, s *big.Int) {
 	return tx.V, tx.R, tx.S</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-295a03b4417a1f933c3aee36" role="button"
                   aria-expanded="false" aria-controls="id-295a03b4417a1f933c3aee36">
                    <code>core/vm/evm.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+5</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/core/vm/evm.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/core/vm/evm.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-295a03b4417a1f933c3aee36"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;evm.go op-geth&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg1">index 888f4812a5901f92ddd26aa400dcf0e4a4c2b9cd..885550ae49fadde4e2526f4cf118d8f188baa2a6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg36">@@ -21,10 +21,12 @@</span> 	&quot;math&#47;big&quot;
 	&quot;sync&#47;atomic&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg31">-	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
 )
&nbsp;
 &#47;&#47; emptyCodeHash is used by create to ensure deployment is disallowed to already
<span class="term-fg36">@@ -67,6 +69,8 @@</span> 	&#47;&#47; Transfer transfers ether from one account to the other
 	Transfer TransferFunc
 	&#47;&#47; GetHash returns the hash corresponding to n
 	GetHash GetHashFunc
<span class="term-fg32">+	&#47;&#47; L1CostFunc returns the L1 cost of the rollup message, the function may be nil, or return nil</span>
<span class="term-fg32">+	L1CostFunc types.L1CostFunc</span>
&nbsp;
 	&#47;&#47; Block information
 	Coinbase    common.Address &#47;&#47; Provides information for COINBASE</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-189ca0296d64b48c6d1d137d" role="button"
                   aria-expanded="false" aria-controls="id-189ca0296d64b48c6d1d137d">
                    <code>eth/api_backend.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+24</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/api_backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/api_backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-189ca0296d64b48c6d1d137d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;api_backend.go op-geth&#47;eth&#47;api_backend.go</span>
<span class="term-fg1">index fad88e801865f9852055ce0529a8d65e38308c70..5a491a8384830e12aea064c087321178584d7657 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;api_backend.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;api_backend.go</span>
<span class="term-fg36">@@ -19,12 +19,14 @@</span>
 import (
 	&quot;context&quot;
 	&quot;errors&quot;
<span class="term-fg32">+	&quot;fmt&quot;</span>
 	&quot;math&#47;big&quot;
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;bloombits&quot;
<span class="term-fg36">@@ -172,7 +174,7 @@</span> 	if err != nil {
 		return nil, nil, err
 	}
 	if header == nil {
<span class="term-fg31">-		return nil, nil, errors.New(&quot;header not found&quot;)</span>
<span class="term-fg32">+		return nil, nil, fmt.Errorf(&quot;header %w&quot;, ethereum.NotFound)</span>
 	}
 	stateDb, err := b.eth.BlockChain().StateAt(header.Root)
 	return stateDb, header, err
<span class="term-fg36">@@ -188,7 +190,7 @@</span> 		if err != nil {
 			return nil, nil, err
 		}
 		if header == nil {
<span class="term-fg31">-			return nil, nil, errors.New(&quot;header for hash not found&quot;)</span>
<span class="term-fg32">+			return nil, nil, fmt.Errorf(&quot;header for hash %w&quot;, ethereum.NotFound)</span>
 		}
 		if blockNrOrHash.RequireCanonical &amp;&amp; b.eth.blockchain.GetCanonicalHash(header.Number.Uint64()) != hash {
 			return nil, nil, errors.New(&quot;hash is not currently canonical&quot;)
<span class="term-fg36">@@ -220,6 +222,7 @@</span> 		vmConfig = b.eth.blockchain.GetVMConfig()
 	}
 	txContext := core.NewEVMTxContext(msg)
 	context := core.NewEVMBlockContext(header, b.eth.BlockChain(), nil)
<span class="term-fg32">+	context.L1CostFunc = types.NewL1CostFunc(b.eth.blockchain.Config(), state)</span>
 	return vm.NewEVM(context, txContext, state, b.eth.blockchain.Config(), *vmConfig), state.Error, nil
 }
&nbsp;
<span class="term-fg36">@@ -247,8 +250,17 @@</span> func (b *EthAPIBackend) SubscribeLogsEvent(ch chan&lt;- []*types.Log) event.Subscription {
 	return b.eth.BlockChain().SubscribeLogsEvent(ch)
 }
&nbsp;
<span class="term-fg31">-func (b *EthAPIBackend) SendTx(ctx context.Context, signedTx *types.Transaction) error {</span>
<span class="term-fg31">-	return b.eth.txPool.AddLocal(signedTx)</span>
<span class="term-fg32">+func (b *EthAPIBackend) SendTx(ctx context.Context, tx *types.Transaction) error {</span>
<span class="term-fg32">+	if b.eth.seqRPCService != nil {</span>
<span class="term-fg32">+		data, err := tx.MarshalBinary()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if err := b.eth.seqRPCService.CallContext(ctx, nil, &quot;eth_sendRawTransaction&quot;, hexutil.Encode(data)); err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return b.eth.txPool.AddLocal(tx)</span>
 }
&nbsp;
 func (b *EthAPIBackend) GetPoolTransactions() (types.Transactions, error) {
<span class="term-fg36">@@ -371,3 +383,11 @@</span>
 func (b *EthAPIBackend) StateAtTransaction(ctx context.Context, block *types.Block, txIndex int, reexec uint64) (core.Message, vm.BlockContext, *state.StateDB, tracers.StateReleaseFunc, error) {
 	return b.eth.stateAtTransaction(block, txIndex, reexec)
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *EthAPIBackend) HistoricalRPCService() *rpc.Client {</span>
<span class="term-fg32">+	return b.eth.historicalRPCService</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *EthAPIBackend) Genesis() *types.Block {</span>
<span class="term-fg32">+	return b.eth.blockchain.Genesis()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9b76af3e14435a6d92bf4901" role="button"
                   aria-expanded="false" aria-controls="id-9b76af3e14435a6d92bf4901">
                    <code>eth/backend.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+33</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9b76af3e14435a6d92bf4901"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;backend.go op-geth&#47;eth&#47;backend.go</span>
<span class="term-fg1">index ab2aaf7b6b12dfb803949e75a553cfaa24e77ec4..ecf37dd109a59e63b5a4d4d76ebe22c58ce492df 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;backend.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;backend.go</span>
<span class="term-fg36">@@ -18,12 +18,14 @@</span> &#47;&#47; Package eth implements the Ethereum protocol.
 package eth
&nbsp;
 import (
<span class="term-fg32">+	&quot;context&quot;</span>
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
 	&quot;runtime&quot;
 	&quot;sync&quot;
 	&quot;sync&#47;atomic&quot;
<span class="term-fg32">+	&quot;time&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -73,6 +75,9 @@</span> 	handler            *handler
 	ethDialCandidates  enode.Iterator
 	snapDialCandidates enode.Iterator
 	merger             *consensus.Merger
<span class="term-fg32">+</span>
<span class="term-fg32">+	seqRPCService        *rpc.Client</span>
<span class="term-fg32">+	historicalRPCService *rpc.Client</span>
&nbsp;
 	&#47;&#47; DB interfaces
 	chainDb ethdb.Database &#47;&#47; Block chain database
<span class="term-fg36">@@ -229,6 +234,7 @@</span> 		BloomCache:     uint64(cacheLimit),
 		EventMux:       eth.eventMux,
 		Checkpoint:     checkpoint,
 		RequiredBlocks: config.RequiredBlocks,
<span class="term-fg32">+		NoTxGossip:     config.RollupDisableTxPoolGossip,</span>
 	}); err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -257,6 +263,26 @@</span> 	if err != nil {
 		return nil, err
 	}
&nbsp;
<span class="term-fg32">+	if config.RollupSequencerHTTP != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupSequencerHTTP)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		eth.seqRPCService = client</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if config.RollupHistoricalRPC != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupHistoricalRPC)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		eth.historicalRPCService = client</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Start the RPC service
 	eth.netRPCService = ethapi.NewNetAPI(eth.p2pServer, config.NetworkId)
&nbsp;
<span class="term-fg36">@@ -275,7 +301,7 @@</span> func makeExtraData(extra []byte) []byte {
 	if len(extra) == 0 {
 		&#47;&#47; create default extradata
 		extra, _ = rlp.EncodeToBytes([]interface{}{
<span class="term-fg31">-			uint(params.VersionMajor&lt;&lt;16 | params.VersionMinor&lt;&lt;8 | params.VersionPatch),</span>
<span class="term-fg32">+			uint(params.OPVersionMajor&lt;&lt;16 | params.OPVersionMinor&lt;&lt;8 | params.OPVersionPatch),</span>
 			&quot;geth&quot;,
 			runtime.Version(),
 			runtime.GOOS,
<span class="term-fg36">@@ -548,6 +574,12 @@</span> 	s.txPool.Stop()
 	s.miner.Close()
 	s.blockchain.Stop()
 	s.engine.Close()
<span class="term-fg32">+	if s.seqRPCService != nil {</span>
<span class="term-fg32">+		s.seqRPCService.Close()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if s.historicalRPCService != nil {</span>
<span class="term-fg32">+		s.historicalRPCService.Close()</span>
<span class="term-fg32">+	}</span>
&nbsp;
 	&#47;&#47; Clean shutdown marker as the last thing before closing db
 	s.shutdownTracker.Stop()</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-011cecf7e4f43755861f3962" role="button"
                   aria-expanded="false" aria-controls="id-011cecf7e4f43755861f3962">
                    <code>eth/ethconfig/config.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+5</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/ethconfig/config.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/ethconfig/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-011cecf7e4f43755861f3962"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;ethconfig&#47;config.go op-geth&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg1">index e9651d041c3c0e2974c2ee246d757d1765906ee6..d6b8d5742444827f8804c84fa4a195c7a9087613 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg36">@@ -216,6 +216,11 @@</span>
 	&#47;&#47; SyncTarget defines the target block of sync. It&#39;s only used for
 	&#47;&#47; development purposes.
 	SyncTarget *types.Block
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupSequencerHTTP string</span>
<span class="term-fg32">+	RollupHistoricalRPC string</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupDisableTxPoolGossip bool</span>
 }
&nbsp;
 &#47;&#47; CreateConsensusEngine creates a consensus engine for the given chain configuration.</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b2562887a0e22b2a4ae6f261" role="button"
                   aria-expanded="false" aria-controls="id-b2562887a0e22b2a4ae6f261">
                    <code>eth/handler.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+4</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/handler.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/handler.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b2562887a0e22b2a4ae6f261"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;handler.go op-geth&#47;eth&#47;handler.go</span>
<span class="term-fg1">index 143147b0c8153b854556cbd4bcf70bc1db3d2202..30721ee7a636a4800bb0d947a041c144a3486241 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;handler.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;handler.go</span>
<span class="term-fg36">@@ -87,6 +87,7 @@</span> 	BloomCache     uint64                    &#47;&#47; Megabytes to alloc for snap sync bloom
 	EventMux       *event.TypeMux            &#47;&#47; Legacy event mux, deprecate for `feed`
 	Checkpoint     *params.TrustedCheckpoint &#47;&#47; Hard coded checkpoint for sync challenges
 	RequiredBlocks map[uint64]common.Hash    &#47;&#47; Hard coded map of required block hashes for sync challenges
<span class="term-fg32">+	NoTxGossip     bool                      &#47;&#47; Disable P2P transaction gossip</span>
 }
&nbsp;
 type handler struct {
<span class="term-fg36">@@ -103,6 +104,8 @@</span> 	database ethdb.Database
 	txpool   txPool
 	chain    *core.BlockChain
 	maxPeers int
<span class="term-fg32">+</span>
<span class="term-fg32">+	noTxGossip bool</span>
&nbsp;
 	downloader   *downloader.Downloader
 	blockFetcher *fetcher.BlockFetcher
<span class="term-fg36">@@ -137,6 +140,7 @@</span> 		forkFilter:     forkid.NewFilter(config.Chain),
 		eventMux:       config.EventMux,
 		database:       config.Database,
 		txpool:         config.TxPool,
<span class="term-fg32">+		noTxGossip:     config.NoTxGossip,</span>
 		chain:          config.Chain,
 		peers:          newPeerSet(),
 		merger:         config.Merger,</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d16027c3f354478fc056f210" role="button"
                   aria-expanded="false" aria-controls="id-d16027c3f354478fc056f210">
                    <code>eth/handler_eth.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+17</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/handler_eth.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/handler_eth.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d16027c3f354478fc056f210"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;handler_eth.go op-geth&#47;eth&#47;handler_eth.go</span>
<span class="term-fg1">index 4ed6335769cf9c32017c19c3037df91e7fabed48..6f573cc3e9a98861531f976b59a8ab67d5d33e51 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;handler_eth.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;handler_eth.go</span>
<span class="term-fg36">@@ -34,7 +34,20 @@</span> &#47;&#47; packets that are sent as replies or broadcasts.
 type ethHandler handler
&nbsp;
 func (h *ethHandler) Chain() *core.BlockChain { return h.chain }
<span class="term-fg31">-func (h *ethHandler) TxPool() eth.TxPool      { return h.txpool }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NilPool satisfies the TxPool interface but does not return any tx in the</span>
<span class="term-fg32">+&#47;&#47; pool. It is used to disable transaction gossip.</span>
<span class="term-fg32">+type NilPool struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NilPool Get always returns nil</span>
<span class="term-fg32">+func (n NilPool) Get(hash common.Hash) *types.Transaction { return nil }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (h *ethHandler) TxPool() eth.TxPool {</span>
<span class="term-fg32">+	if h.noTxGossip {</span>
<span class="term-fg32">+		return &amp;NilPool{}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return h.txpool</span>
<span class="term-fg32">+}</span>
&nbsp;
 &#47;&#47; RunPeer is invoked when a peer joins on the `eth` protocol.
 func (h *ethHandler) RunPeer(peer *eth.Peer, hand eth.Handler) error {
<span class="term-fg36">@@ -52,6 +65,9 @@</span>
 &#47;&#47; AcceptTxs retrieves whether transaction processing is enabled on the node
 &#47;&#47; or if inbound transactions should simply be dropped.
 func (h *ethHandler) AcceptTxs() bool {
<span class="term-fg32">+	if h.noTxGossip {</span>
<span class="term-fg32">+		return false</span>
<span class="term-fg32">+	}</span>
 	return atomic.LoadUint32(&amp;h.acceptTxs) == 1
 }
</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b67e3054f5c1b71ab5a2c147" role="button"
                   aria-expanded="false" aria-controls="id-b67e3054f5c1b71ab5a2c147">
                    <code>eth/state_accessor.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/state_accessor.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/state_accessor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b67e3054f5c1b71ab5a2c147"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;state_accessor.go op-geth&#47;eth&#47;state_accessor.go</span>
<span class="term-fg1">index ca59024aed48d73804ad256f2373e83177b43738..10debac33dcd7750365cb99af1cda6a79fb7f79e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;state_accessor.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;state_accessor.go</span>
<span class="term-fg36">@@ -211,6 +211,7 @@</span> 		context := core.NewEVMBlockContext(block.Header(), eth.blockchain, nil)
 		if idx == txIndex {
 			return msg, context, statedb, release, nil
 		}
<span class="term-fg32">+		context.L1CostFunc = types.NewL1CostFunc(eth.blockchain.Config(), statedb)</span>
 		&#47;&#47; Not yet the searched for transaction, execute on top of the current state
 		vmenv := vm.NewEVM(context, txContext, statedb, eth.blockchain.Config(), vm.Config{})
 		statedb.Prepare(tx.Hash(), idx)</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e49ecc9103044a1da779ccc1" role="button"
                   aria-expanded="false" aria-controls="id-e49ecc9103044a1da779ccc1">
                    <code>eth/tracers/api.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+59</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/tracers/api.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/tracers/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e49ecc9103044a1da779ccc1"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;api.go op-geth&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg1">index c0d9dfb061f245226ea9357e74c2d4249e4e1b33..bce70dfa2f429f7a48f86e1c2585831ea57d20c6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg36">@@ -28,6 +28,7 @@</span> 	&quot;runtime&quot;
 	&quot;sync&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
<span class="term-fg36">@@ -86,6 +87,7 @@</span> 	Engine() consensus.Engine
 	ChainDb() ethdb.Database
 	StateAtBlock(ctx context.Context, block *types.Block, reexec uint64, base *state.StateDB, readOnly bool, preferDisk bool) (*state.StateDB, StateReleaseFunc, error)
 	StateAtTransaction(ctx context.Context, block *types.Block, txIndex int, reexec uint64) (core.Message, vm.BlockContext, *state.StateDB, StateReleaseFunc, error)
<span class="term-fg32">+	HistoricalRPCService() *rpc.Client</span>
 }
&nbsp;
 &#47;&#47; API is the collection of tracing APIs exposed over the private debugging endpoint.
<span class="term-fg36">@@ -136,7 +138,7 @@</span> 	if err != nil {
 		return nil, err
 	}
 	if block == nil {
<span class="term-fg31">-		return nil, fmt.Errorf(&quot;block #%d not found&quot;, number)</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;block #%d %w&quot;, number, ethereum.NotFound)</span>
 	}
 	return block, nil
 }
<span class="term-fg36">@@ -149,7 +151,7 @@</span> 	if err != nil {
 		return nil, err
 	}
 	if block == nil {
<span class="term-fg31">-		return nil, fmt.Errorf(&quot;block %s not found&quot;, hash.Hex())</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;block %s %w&quot;, hash.Hex(), ethereum.NotFound)</span>
 	}
 	return block, nil
 }
<span class="term-fg36">@@ -289,6 +291,7 @@</span> 				var (
 					signer   = types.MakeSigner(api.backend.ChainConfig(), task.block.Number())
 					blockCtx = core.NewEVMBlockContext(task.block.Header(), api.chainContext(ctx), nil)
 				)
<span class="term-fg32">+				blockCtx.L1CostFunc = types.NewL1CostFunc(api.backend.ChainConfig(), task.statedb)</span>
 				&#47;&#47; Trace all the transactions contained within
 				for i, tx := range task.block.Transactions() {
 					msg, _ := tx.AsMessage(signer, task.block.BaseFee())
<span class="term-fg36">@@ -453,7 +456,14 @@</span> &#47;&#47; TraceBlockByNumber returns the structured logs created during the execution of
 &#47;&#47; EVM and returns them as a JSON object.
 func (api *API) TraceBlockByNumber(ctx context.Context, number rpc.BlockNumber, config *TraceConfig) ([]*txTraceResult, error) {
 	block, err := api.blockByNumber(ctx, number)
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg32">+	if errors.Is(err, ethereum.NotFound) &amp;&amp; api.backend.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+		var histResult []*txTraceResult</span>
<span class="term-fg32">+		err = api.backend.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;debug_traceBlockByNumber&quot;, number, config)</span>
<span class="term-fg32">+		if err != nil &amp;&amp; err.Error() == &quot;not found&quot; {</span>
<span class="term-fg32">+			return nil, fmt.Errorf(&quot;block #%d %w&quot;, number, ethereum.NotFound)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return histResult, err</span>
<span class="term-fg32">+	} else if err != nil {</span>
 		return nil, err
 	}
 	return api.traceBlock(ctx, block, config)
<span class="term-fg36">@@ -463,7 +473,14 @@</span> &#47;&#47; TraceBlockByHash returns the structured logs created during the execution of
 &#47;&#47; EVM and returns them as a JSON object.
 func (api *API) TraceBlockByHash(ctx context.Context, hash common.Hash, config *TraceConfig) ([]*txTraceResult, error) {
 	block, err := api.blockByHash(ctx, hash)
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg32">+	if errors.Is(err, ethereum.NotFound) &amp;&amp; api.backend.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+		var histResult []*txTraceResult</span>
<span class="term-fg32">+		err = api.backend.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;debug_traceBlockByHash&quot;, hash, config)</span>
<span class="term-fg32">+		if err != nil &amp;&amp; err.Error() == &quot;not found&quot; {</span>
<span class="term-fg32">+			return nil, fmt.Errorf(&quot;block #%d %w&quot;, hash, ethereum.NotFound)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return histResult, err</span>
<span class="term-fg32">+	} else if err != nil {</span>
 		return nil, err
 	}
 	return api.traceBlock(ctx, block, config)
<span class="term-fg36">@@ -546,6 +563,7 @@</span> 		chainConfig        = api.backend.ChainConfig()
 		vmctx              = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)
 		deleteEmptyObjects = chainConfig.IsEIP158(block.Number())
 	)
<span class="term-fg32">+	vmctx.L1CostFunc = types.NewL1CostFunc(chainConfig, statedb)</span>
 	for i, tx := range block.Transactions() {
 		var (
 			msg, _    = tx.AsMessage(signer, block.BaseFee())
<span class="term-fg36">@@ -621,6 +639,7 @@</span> 		pend.Add(1)
 		go func() {
 			blockCtx := core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)
 			defer pend.Done()
<span class="term-fg32">+			blockCtx.L1CostFunc = types.NewL1CostFunc(api.backend.ChainConfig(), statedb)</span>
 			&#47;&#47; Fetch and execute the next transaction trace tasks
 			for task := range jobs {
 				msg, _ := txs[task.index].AsMessage(signer, block.BaseFee())
<span class="term-fg36">@@ -641,6 +660,7 @@</span> 	}
 	&#47;&#47; Feed the transactions into the tracers and return
 	var failed error
 	blockCtx := core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)
<span class="term-fg32">+	blockCtx.L1CostFunc = types.NewL1CostFunc(api.backend.ChainConfig(), statedb)</span>
 	for i, tx := range txs {
 		&#47;&#47; Send the trace task over for execution
 		jobs &lt;- &amp;txTraceTask{statedb: statedb.Copy(), index: i}
<span class="term-fg36">@@ -730,6 +750,7 @@</span> 			chainConfig.BerlinBlock = berlin
 			canon = false
 		}
 	}
<span class="term-fg32">+	vmctx.L1CostFunc = types.NewL1CostFunc(chainConfig, statedb)</span>
 	for i, tx := range block.Transactions() {
 		&#47;&#47; Prepare the transaction for un-traced execution
 		var (
<span class="term-fg36">@@ -801,10 +822,19 @@</span>
 &#47;&#47; TraceTransaction returns the structured logs created during the execution of EVM
 &#47;&#47; and returns them as a JSON object.
 func (api *API) TraceTransaction(ctx context.Context, hash common.Hash, config *TraceConfig) (interface{}, error) {
<span class="term-fg31">-	_, blockHash, blockNumber, index, err := api.backend.GetTransaction(ctx, hash)</span>
<span class="term-fg32">+	&#47;&#47; GetTransaction returns 0 for the blocknumber if the transaction is not found</span>
<span class="term-fg32">+	tx, blockHash, blockNumber, index, err := api.backend.GetTransaction(ctx, hash)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg32">+	if tx == nil {</span>
<span class="term-fg32">+		var histResult []*txTraceResult</span>
<span class="term-fg32">+		err = api.backend.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;debug_traceTransaction&quot;, hash, config)</span>
<span class="term-fg32">+		if err != nil &amp;&amp; err.Error() == &quot;not found&quot; {</span>
<span class="term-fg32">+			return nil, fmt.Errorf(&quot;transaction %s %w&quot;, hash, ethereum.NotFound)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return histResult, err</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; It shouldn&#39;t happen in practice.
 	if blockNumber == 0 {
 		return nil, errors.New(&quot;genesis is not traceable&quot;)
<span class="term-fg36">@@ -855,6 +885,29 @@</span> 		block, err = api.blockByNumber(ctx, number)
 	} else {
 		return nil, errors.New(&quot;invalid arguments; neither block nor hash specified&quot;)
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; If block still holds no value, but we have an error, then one of the two previous conditions</span>
<span class="term-fg32">+	&#47;&#47; was entered, meaning:</span>
<span class="term-fg32">+	&#47;&#47; 1. blockNrOrHash has either a valid block or hash</span>
<span class="term-fg32">+	&#47;&#47; 2. we don&#39;t have that block locally</span>
<span class="term-fg32">+	if block == nil &amp;&amp; errors.Is(err, ethereum.NotFound) &amp;&amp; api.backend.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+		var histResult json.RawMessage</span>
<span class="term-fg32">+		err = api.backend.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;debug_traceCall&quot;, args, blockNrOrHash, config)</span>
<span class="term-fg32">+		if err != nil &amp;&amp; err.Error() == &quot;not found&quot; {</span>
<span class="term-fg32">+			&#47;&#47; Not found locally or in history. We need to return different errors based on the input</span>
<span class="term-fg32">+			&#47;&#47; in order match geth&#39;s native behavior</span>
<span class="term-fg32">+			if hash, ok := blockNrOrHash.Hash(); ok {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;block %s %w&quot;, hash, ethereum.NotFound)</span>
<span class="term-fg32">+			} else if number, ok := blockNrOrHash.Number(); ok {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;block #%d %w&quot;, number, ethereum.NotFound)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		} else if err != nil {</span>
<span class="term-fg32">+			return nil, fmt.Errorf(&quot;error querying historical RPC: %w&quot;, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		return histResult, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -877,6 +930,7 @@</span> 			return nil, err
 		}
 		config.BlockOverrides.Apply(&amp;vmctx)
 	}
<span class="term-fg32">+	vmctx.L1CostFunc = types.NewL1CostFunc(api.backend.ChainConfig(), statedb)</span>
 	&#47;&#47; Execute the trace
 	msg, err := args.ToMessage(api.backend.RPCGasCap(), block.BaseFee())
 	if err != nil {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6b22099ee554bc5b5384f5da" role="button"
                   aria-expanded="false" aria-controls="id-6b22099ee554bc5b5384f5da">
                    <code>eth/tracers/api_test.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+156</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-9</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/eth/tracers/api_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/eth/tracers/api_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6b22099ee554bc5b5384f5da"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;api_test.go op-geth&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg1">index adf65d33fb4fb2e757adf472f607d9f25edd2698..97e27c07426bd3f2e5f95efbee2d013841f50b0c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg36">@@ -24,12 +24,15 @@</span> 	&quot;encoding&#47;json&quot;
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
<span class="term-fg32">+	&quot;net&quot;</span>
<span class="term-fg32">+	&quot;net&#47;http&quot;</span>
 	&quot;reflect&quot;
 	&quot;sort&quot;
 	&quot;sync&#47;atomic&quot;
 	&quot;testing&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
<span class="term-fg36">@@ -43,16 +46,92 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&#47;logger&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;ethdb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;node&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
 )
&nbsp;
 var (
<span class="term-fg31">-	errStateNotFound       = errors.New(&quot;state not found&quot;)</span>
<span class="term-fg31">-	errBlockNotFound       = errors.New(&quot;block not found&quot;)</span>
<span class="term-fg31">-	errTransactionNotFound = errors.New(&quot;transaction not found&quot;)</span>
<span class="term-fg32">+	errStateNotFound   = errors.New(&quot;state not found&quot;)</span>
<span class="term-fg32">+	errBlockNotFound   = errors.New(&quot;block not found&quot;)</span>
<span class="term-fg32">+	errFailingUpstream = errors.New(&quot;historical query failed&quot;)</span>
 )
&nbsp;
<span class="term-fg32">+type mockHistoricalBackend struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) TraceBlockByHash(ctx context.Context, hash common.Hash, config *TraceConfig) ([]*txTraceResult, error) {</span>
<span class="term-fg32">+	if hash == common.HexToHash(&quot;0xabba&quot;) {</span>
<span class="term-fg32">+		result := make([]*txTraceResult, 1)</span>
<span class="term-fg32">+		result[0] = &amp;txTraceResult{Result: &quot;0xabba&quot;}</span>
<span class="term-fg32">+		return result, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) TraceBlockByNumber(ctx context.Context, number rpc.BlockNumber, config *TraceConfig) ([]*txTraceResult, error) {</span>
<span class="term-fg32">+	if number == 999 {</span>
<span class="term-fg32">+		result := make([]*txTraceResult, 1)</span>
<span class="term-fg32">+		result[0] = &amp;txTraceResult{Result: &quot;0xabba&quot;}</span>
<span class="term-fg32">+		return result, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) TraceTransaction(ctx context.Context, hash common.Hash, config *TraceConfig) (interface{}, error) {</span>
<span class="term-fg32">+	if hash == common.HexToHash(&quot;0xACDC&quot;) {</span>
<span class="term-fg32">+		result := make([]*txTraceResult, 1)</span>
<span class="term-fg32">+		result[0] = &amp;txTraceResult{Result: &quot;0x8888&quot;}</span>
<span class="term-fg32">+		return result, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) TraceCall(ctx context.Context, args ethapi.TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, config *TraceCallConfig) (interface{}, error) {</span>
<span class="term-fg32">+	num, ok := blockNrOrHash.Number()</span>
<span class="term-fg32">+	if ok &amp;&amp; num == 777 {</span>
<span class="term-fg32">+		return json.RawMessage(`{&quot;gas&quot;:21000,&quot;failed&quot;:false,&quot;returnValue&quot;:&quot;777&quot;,&quot;structLogs&quot;:[]}`), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if ok &amp;&amp; num == 12345 {</span>
<span class="term-fg32">+		return nil, errFailingUpstream</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func newMockHistoricalBackend(t *testing.T) string {</span>
<span class="term-fg32">+	s := rpc.NewServer()</span>
<span class="term-fg32">+	err := node.RegisterApis([]rpc.API{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			Namespace:     &quot;debug&quot;,</span>
<span class="term-fg32">+			Service:       new(mockHistoricalBackend),</span>
<span class="term-fg32">+			Public:        true,</span>
<span class="term-fg32">+			Authenticated: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}, nil, s)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	hdlr := node.NewHTTPHandlerStack(s, []string{&quot;*&quot;}, []string{&quot;*&quot;}, nil)</span>
<span class="term-fg32">+	mux := http.NewServeMux()</span>
<span class="term-fg32">+	mux.Handle(&quot;&#47;&quot;, hdlr)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	listener, err := net.Listen(&quot;tcp&quot;, &quot;127.0.0.1:0&quot;)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend listener: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	go func() {</span>
<span class="term-fg32">+		httpS := &amp;http.Server{Handler: mux}</span>
<span class="term-fg32">+		httpS.Serve(listener)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Cleanup(func() {</span>
<span class="term-fg32">+			httpS.Shutdown(context.Background())</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;http:&#47;&#47;%s&quot;, listener.Addr().String())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 type testBackend struct {
 	chainConfig *params.ChainConfig
 	engine      consensus.Engine
<span class="term-fg36">@@ -61,15 +140,25 @@</span> 	chain       *core.BlockChain
&nbsp;
 	refHook func() &#47;&#47; Hook is invoked when the requested state is referenced
 	relHook func() &#47;&#47; Hook is invoked when the requested state is released
<span class="term-fg32">+</span>
<span class="term-fg32">+	historical *rpc.Client</span>
 }
&nbsp;
 &#47;&#47; testBackend creates a new test backend. OBS: After test is done, teardown must be
 &#47;&#47; invoked in order to release associated resources.
 func newTestBackend(t *testing.T, n int, gspec *core.Genesis, generator func(i int, b *core.BlockGen)) *testBackend {
<span class="term-fg32">+	historicalAddr := newMockHistoricalBackend(t)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	historicalClient, err := rpc.Dial(historicalAddr)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error making historical client: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	backend := &amp;testBackend{
 		chainConfig: gspec.Config,
 		engine:      ethash.NewFaker(),
 		chaindb:     rawdb.NewMemoryDatabase(),
<span class="term-fg32">+		historical:  historicalClient,</span>
 	}
 	&#47;&#47; Generate blocks for testing
 	_, blocks, _ := core.GenerateChainWithGenesis(gspec, backend.engine, n, generator)
<span class="term-fg36">@@ -118,7 +207,7 @@</span>
 func (b *testBackend) GetTransaction(ctx context.Context, txHash common.Hash) (*types.Transaction, common.Hash, uint64, uint64, error) {
 	tx, hash, blockNumber, index := rawdb.ReadTransaction(b.chaindb, txHash)
 	if tx == nil {
<span class="term-fg31">-		return nil, common.Hash{}, 0, 0, errTransactionNotFound</span>
<span class="term-fg32">+		return nil, common.Hash{}, 0, 0, nil</span>
 	}
 	return tx, hash, blockNumber, index, nil
 }
<span class="term-fg36">@@ -181,6 +270,7 @@</span> 		context := core.NewEVMBlockContext(block.Header(), b.chain, nil)
 		if idx == txIndex {
 			return msg, context, statedb, release, nil
 		}
<span class="term-fg32">+		context.L1CostFunc = types.NewL1CostFunc(b.chainConfig, statedb)</span>
 		vmenv := vm.NewEVM(context, txContext, statedb, b.chainConfig, vm.Config{})
 		if _, err := core.ApplyMessage(vmenv, msg, new(core.GasPool).AddGas(tx.Gas())); err != nil {
 			return nil, vm.BlockContext{}, nil, nil, fmt.Errorf(&quot;transaction %#x failed: %v&quot;, tx.Hash(), err)
<span class="term-fg36">@@ -190,6 +280,10 @@</span> 	}
 	return nil, vm.BlockContext{}, nil, nil, fmt.Errorf(&quot;transaction index %d out of range for block %#x&quot;, txIndex, block.Hash())
 }
&nbsp;
<span class="term-fg32">+func (b *testBackend) HistoricalRPCService() *rpc.Client {</span>
<span class="term-fg32">+	return b.historical</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func TestTraceCall(t *testing.T) {
 	t.Parallel()
&nbsp;
<span class="term-fg36">@@ -254,9 +348,43 @@</span> 				To:    &amp;accounts[1].addr,
 				Value: (*hexutil.Big)(big.NewInt(1000)),
 			},
 			config:    nil,
<span class="term-fg31">-			expectErr: fmt.Errorf(&quot;block #%d not found&quot;, genBlocks+1),</span>
<span class="term-fg32">+			expectErr: fmt.Errorf(&quot;block #%d %w&quot;, genBlocks+1, ethereum.NotFound),</span>
 			&#47;&#47;expect:    nil,
 		},
<span class="term-fg32">+		&#47;&#47; Optimism: Trace block on the historical chain</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			blockNumber: rpc.BlockNumber(777),</span>
<span class="term-fg32">+			call: ethapi.TransactionArgs{</span>
<span class="term-fg32">+				From:  &amp;accounts[0].addr,</span>
<span class="term-fg32">+				To:    &amp;accounts[1].addr,</span>
<span class="term-fg32">+				Value: (*hexutil.Big)(big.NewInt(1000)),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			config:    nil,</span>
<span class="term-fg32">+			expectErr: nil,</span>
<span class="term-fg32">+			expect:    `{&quot;gas&quot;:21000,&quot;failed&quot;:false,&quot;returnValue&quot;:&quot;777&quot;,&quot;structLogs&quot;:[]}`,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Optimism: Trace block that doesn&#39;t exist anywhere</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			blockNumber: rpc.BlockNumber(39347856),</span>
<span class="term-fg32">+			call: ethapi.TransactionArgs{</span>
<span class="term-fg32">+				From:  &amp;accounts[0].addr,</span>
<span class="term-fg32">+				To:    &amp;accounts[1].addr,</span>
<span class="term-fg32">+				Value: (*hexutil.Big)(big.NewInt(1000)),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			config:    nil,</span>
<span class="term-fg32">+			expectErr: fmt.Errorf(&quot;block #39347856 %w&quot;, ethereum.NotFound),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Optimism: Trace block with failing historical upstream</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			blockNumber: rpc.BlockNumber(12345),</span>
<span class="term-fg32">+			call: ethapi.TransactionArgs{</span>
<span class="term-fg32">+				From:  &amp;accounts[0].addr,</span>
<span class="term-fg32">+				To:    &amp;accounts[1].addr,</span>
<span class="term-fg32">+				Value: (*hexutil.Big)(big.NewInt(1000)),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			config:    nil,</span>
<span class="term-fg32">+			expectErr: fmt.Errorf(&quot;error querying historical RPC: %w&quot;, errFailingUpstream),</span>
<span class="term-fg32">+		},</span>
 		&#47;&#47; Standard JSON trace upon the latest block
 		{
 			blockNumber: rpc.LatestBlockNumber,
<span class="term-fg36">@@ -302,8 +430,10 @@</span> 			if err == nil {
 				t.Errorf(&quot;test %d: expect error %v, got nothing&quot;, i, testspec.expectErr)
 				continue
 			}
<span class="term-fg31">-			if !reflect.DeepEqual(err, testspec.expectErr) {</span>
<span class="term-fg31">-				t.Errorf(&quot;test %d: error mismatch, want %v, git %v&quot;, i, testspec.expectErr, err)</span>
<span class="term-fg32">+			&#47;&#47; Have to introduce this diff to reflect the fact that errors</span>
<span class="term-fg32">+			&#47;&#47; from the upstream will not preserve pointer equality.</span>
<span class="term-fg32">+			if err.Error() != testspec.expectErr.Error() {</span>
<span class="term-fg32">+				t.Errorf(&quot;test %d: error mismatch, want %v, got %v&quot;, i, testspec.expectErr, err)</span>
 			}
 		} else {
 			if err != nil {
<span class="term-fg36">@@ -365,6 +495,18 @@</span> 		StructLogs:  []logger.StructLogRes{},
 	}) {
 		t.Error(&quot;Transaction tracing result is different&quot;)
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; test TraceTransaction for a historical transaction</span>
<span class="term-fg32">+	result2, err := api.TraceTransaction(context.Background(), common.HexToHash(&quot;0xACDC&quot;), nil)</span>
<span class="term-fg32">+	resBytes, _ := json.Marshal(result2)</span>
<span class="term-fg32">+	have2 := string(resBytes)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Errorf(&quot;want no error, have %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	want2 := `[{&quot;result&quot;:&quot;0x8888&quot;}]`</span>
<span class="term-fg32">+	if have2 != want2 {</span>
<span class="term-fg32">+		t.Errorf(&quot;test result mismatch, have\n%v\n, want\n%v\n&quot;, have2, want2)</span>
<span class="term-fg32">+	}</span>
 }
&nbsp;
 func TestTraceBlock(t *testing.T) {
<span class="term-fg36">@@ -411,7 +553,12 @@</span> 		},
 		&#47;&#47; Trace non-existent block
 		{
 			blockNumber: rpc.BlockNumber(genBlocks + 1),
<span class="term-fg31">-			expectErr:   fmt.Errorf(&quot;block #%d not found&quot;, genBlocks+1),</span>
<span class="term-fg32">+			expectErr:   fmt.Errorf(&quot;block #%d %w&quot;, genBlocks+1, ethereum.NotFound),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Optimism: Trace block on the historical chain</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			blockNumber: rpc.BlockNumber(999),</span>
<span class="term-fg32">+			want:        `[{&quot;result&quot;:&quot;0xabba&quot;}]`,</span>
 		},
 		&#47;&#47; Trace latest block
 		{
<span class="term-fg36">@@ -431,7 +578,7 @@</span> 			if err == nil {
 				t.Errorf(&quot;test %d, want error %v&quot;, i, tc.expectErr)
 				continue
 			}
<span class="term-fg31">-			if !reflect.DeepEqual(err, tc.expectErr) {</span>
<span class="term-fg32">+			if err.Error() != tc.expectErr.Error() {</span>
 				t.Errorf(&quot;test %d: error mismatch, want %v, get %v&quot;, i, tc.expectErr, err)
 			}
 			continue</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-46a79dd083d9145c5aa86e84" role="button"
                   aria-expanded="false" aria-controls="id-46a79dd083d9145c5aa86e84">
                    <code>ethclient/ethclient_test.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+101</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/ethclient/ethclient_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/ethclient/ethclient_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-46a79dd083d9145c5aa86e84"><span class="term-fg1">diff --git go-ethereum&#47;ethclient&#47;ethclient_test.go op-geth&#47;ethclient&#47;ethclient_test.go</span>
<span class="term-fg1">index 8bd8b0614c2d6f0fe37b5dd9c0a2da86f57d1892..66c703a68726dc36fda1cfdf281495fa8b618c8b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;ethclient&#47;ethclient_test.go</span>
<span class="term-fg1">+++ op-geth&#47;ethclient&#47;ethclient_test.go</span>
<span class="term-fg36">@@ -22,9 +22,14 @@</span> 	&quot;context&quot;
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
<span class="term-fg32">+	&quot;net&quot;</span>
<span class="term-fg32">+	&quot;net&#47;http&quot;</span>
 	&quot;reflect&quot;
 	&quot;testing&quot;
 	&quot;time&quot;
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -210,7 +215,62 @@</span> 	Gas:      params.TxGas,
 	To:       &amp;common.Address{2},
 })
&nbsp;
<span class="term-fg32">+type mockHistoricalBackend struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) Call(ctx context.Context, args ethapi.TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *ethapi.StateOverride) (hexutil.Bytes, error) {</span>
<span class="term-fg32">+	num, ok := blockNrOrHash.Number()</span>
<span class="term-fg32">+	if ok &amp;&amp; num == 100 {</span>
<span class="term-fg32">+		return hexutil.Bytes(&quot;test&quot;), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) EstimateGas(ctx context.Context, args ethapi.TransactionArgs, blockNrOrHash *rpc.BlockNumberOrHash) (hexutil.Uint64, error) {</span>
<span class="term-fg32">+	num, ok := blockNrOrHash.Number()</span>
<span class="term-fg32">+	if ok &amp;&amp; num == 100 {</span>
<span class="term-fg32">+		return hexutil.Uint64(12345), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return 0, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func newMockHistoricalBackend(t *testing.T) string {</span>
<span class="term-fg32">+	s := rpc.NewServer()</span>
<span class="term-fg32">+	err := node.RegisterApis([]rpc.API{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			Namespace:     &quot;eth&quot;,</span>
<span class="term-fg32">+			Service:       new(mockHistoricalBackend),</span>
<span class="term-fg32">+			Public:        true,</span>
<span class="term-fg32">+			Authenticated: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}, nil, s)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	hdlr := node.NewHTTPHandlerStack(s, []string{&quot;*&quot;}, []string{&quot;*&quot;}, nil)</span>
<span class="term-fg32">+	mux := http.NewServeMux()</span>
<span class="term-fg32">+	mux.Handle(&quot;&#47;&quot;, hdlr)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	listener, err := net.Listen(&quot;tcp&quot;, &quot;127.0.0.1:0&quot;)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend listener: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	go func() {</span>
<span class="term-fg32">+		httpS := &amp;http.Server{Handler: mux}</span>
<span class="term-fg32">+		httpS.Serve(listener)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Cleanup(func() {</span>
<span class="term-fg32">+			httpS.Shutdown(context.Background())</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;http:&#47;&#47;%s&quot;, listener.Addr().String())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func newTestBackend(t *testing.T) (*node.Node, []*types.Block) {
<span class="term-fg32">+	histAddr := newMockHistoricalBackend(t)</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Generate test chain.
 	blocks := generateTestChain()
&nbsp;
<span class="term-fg36">@@ -222,6 +282,7 @@</span> 	}
 	&#47;&#47; Create Ethereum Service
 	config := &amp;ethconfig.Config{Genesis: genesis}
 	config.Ethash.PowMode = ethash.ModeFake
<span class="term-fg32">+	config.RollupHistoricalRPC = histAddr</span>
 	ethservice, err := eth.New(n, config)
 	if err != nil {
 		t.Fatalf(&quot;can&#39;t create new ethereum service: %v&quot;, err)
<span class="term-fg36">@@ -288,6 +349,9 @@</span> 			func(t *testing.T) { testAtFunctions(t, client) },
 		},
 		&quot;TransactionSender&quot;: {
 			func(t *testing.T) { testTransactionSender(t, client) },
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&quot;EstimateGas&quot;: {</span>
<span class="term-fg32">+			func(t *testing.T) { testEstimateGas(t, client) },</span>
 		},
 	}
&nbsp;
<span class="term-fg36">@@ -580,6 +644,14 @@</span> 	&#47;&#47; PendingCallContract
 	if _, err := ec.PendingCallContract(context.Background(), msg); err != nil {
 		t.Fatalf(&quot;unexpected error: %v&quot;, err)
 	}
<span class="term-fg32">+	&#47;&#47; Historical</span>
<span class="term-fg32">+	histVal, err := ec.CallContract(context.Background(), msg, big.NewInt(100))</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected error: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if string(histVal) != &quot;test&quot; {</span>
<span class="term-fg32">+		t.Fatalf(&quot;expected %s to equal test&quot;, string(histVal))</span>
<span class="term-fg32">+	}</span>
 }
&nbsp;
 func testAtFunctions(t *testing.T, client *rpc.Client) {
<span class="term-fg36">@@ -684,6 +756,35 @@</span> 		t.Fatal(err)
 	}
 	if sender2 != testAddr {
 		t.Fatal(&quot;wrong sender:&quot;, sender2)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func testEstimateGas(t *testing.T, client *rpc.Client) {</span>
<span class="term-fg32">+	ec := NewClient(client)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; EstimateGas</span>
<span class="term-fg32">+	msg := ethereum.CallMsg{</span>
<span class="term-fg32">+		From:  testAddr,</span>
<span class="term-fg32">+		To:    &amp;common.Address{},</span>
<span class="term-fg32">+		Gas:   21000,</span>
<span class="term-fg32">+		Value: big.NewInt(1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	gas, err := ec.EstimateGas(context.Background(), msg)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected error: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if gas != 21000 {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected gas price: %v&quot;, gas)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; historical case</span>
<span class="term-fg32">+	var res hexutil.Uint64</span>
<span class="term-fg32">+	err = client.CallContext(context.Background(), &amp;res, &quot;eth_estimateGas&quot;, toCallArg(msg), rpc.BlockNumberOrHashWithNumber(100))</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected error: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if res != 12345 {</span>
<span class="term-fg32">+		t.Fatalf(&quot;invalid result: %d&quot;, res)</span>
 	}
 }
</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2714a8532973f3ce79b1f12f" role="button"
                   aria-expanded="false" aria-controls="id-2714a8532973f3ce79b1f12f">
                    <code>internal/ethapi/api.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+54</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/internal/ethapi/api.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/internal/ethapi/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2714a8532973f3ce79b1f12f"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;ethapi&#47;api.go op-geth&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg1">index 538644908ba00a305d690a642f1e0da479fa1b3e..181bcb0470a291692b5b48b04ccdae8b5ec749e2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg36">@@ -26,6 +26,9 @@</span> 	&quot;strings&quot;
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;davecgh&#47;go-spew&#47;spew&quot;
<span class="term-fg32">+	&quot;github.com&#47;tyler-smith&#47;go-bip39&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;keystore&quot;
<span class="term-fg36">@@ -46,8 +49,9 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;p2p&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
<span class="term-fg31">-	&quot;github.com&#47;tyler-smith&#47;go-bip39&quot;</span>
 )
<span class="term-fg32">+</span>
<span class="term-fg32">+var ErrHeaderNotFound = fmt.Errorf(&quot;header %w&quot;, ethereum.NotFound)</span>
&nbsp;
 &#47;&#47; EthereumAPI provides an API to access Ethereum related information.
 type EthereumAPI struct {
<span class="term-fg36">@@ -1042,7 +1046,11 @@</span> &#47;&#47; Note, this function doesn&#39;t make and changes in the state&#47;blockchain and is
 &#47;&#47; useful to execute and retrieve values.
 func (s *BlockChainAPI) Call(ctx context.Context, args TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *StateOverride) (hexutil.Bytes, error) {
 	result, err := DoCall(ctx, s.b, args, blockNrOrHash, overrides, s.b.RPCEVMTimeout(), s.b.RPCGasCap())
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg32">+	if errors.Is(err, ethereum.NotFound) &amp;&amp; s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+		var histResult hexutil.Bytes</span>
<span class="term-fg32">+		err = s.b.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;eth_call&quot;, args, blockNrOrHash, overrides)</span>
<span class="term-fg32">+		return histResult, err</span>
<span class="term-fg32">+	} else if err != nil {</span>
 		return nil, err
 	}
 	&#47;&#47; If the result contains a revert reason, try to unpack and return it.
<span class="term-fg36">@@ -1179,7 +1187,17 @@</span> 	bNrOrHash := rpc.BlockNumberOrHashWithNumber(rpc.PendingBlockNumber)
 	if blockNrOrHash != nil {
 		bNrOrHash = *blockNrOrHash
 	}
<span class="term-fg31">-	return DoEstimateGas(ctx, s.b, args, bNrOrHash, s.b.RPCGasCap())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	res, err := DoEstimateGas(ctx, s.b, args, bNrOrHash, s.b.RPCGasCap())</span>
<span class="term-fg32">+	if errors.Is(err, ethereum.NotFound) &amp;&amp; s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+		var result hexutil.Uint64</span>
<span class="term-fg32">+		err := s.b.HistoricalRPCService().CallContext(ctx, &amp;result, &quot;eth_estimateGas&quot;, args, blockNrOrHash)</span>
<span class="term-fg32">+		return result, err</span>
<span class="term-fg32">+	} else if err != nil {</span>
<span class="term-fg32">+		return 0, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return res, err</span>
 }
&nbsp;
 &#47;&#47; RPCMarshalHeader converts the given header to the RPC output .
<span class="term-fg36">@@ -1289,6 +1307,11 @@</span> 	ChainID          *hexutil.Big      `json:&quot;chainId,omitempty&quot;`
 	V                *hexutil.Big      `json:&quot;v&quot;`
 	R                *hexutil.Big      `json:&quot;r&quot;`
 	S                *hexutil.Big      `json:&quot;s&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; deposit-tx only</span>
<span class="term-fg32">+	SourceHash *common.Hash `json:&quot;sourceHash,omitempty&quot;`</span>
<span class="term-fg32">+	Mint       *hexutil.Big `json:&quot;mint,omitempty&quot;`</span>
<span class="term-fg32">+	IsSystemTx *bool        `json:&quot;isSystemTx,omitempty&quot;`</span>
 }
&nbsp;
 &#47;&#47; newRPCTransaction returns a transaction that will serialize to the RPC
<span class="term-fg36">@@ -1296,6 +1319,28 @@</span> &#47;&#47; representation, with the given location metadata set (if available).
 func newRPCTransaction(tx *types.Transaction, blockHash common.Hash, blockNumber uint64, index uint64, baseFee *big.Int, config *params.ChainConfig) *RPCTransaction {
 	signer := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber))
 	from, _ := types.Sender(signer, tx)
<span class="term-fg32">+	if tx.Type() == types.DepositTxType {</span>
<span class="term-fg32">+		srcHash := tx.SourceHash()</span>
<span class="term-fg32">+		isSystemTx := tx.IsSystemTx()</span>
<span class="term-fg32">+		result := &amp;RPCTransaction{</span>
<span class="term-fg32">+			Type:       hexutil.Uint64(tx.Type()),</span>
<span class="term-fg32">+			From:       from,</span>
<span class="term-fg32">+			Gas:        hexutil.Uint64(tx.Gas()),</span>
<span class="term-fg32">+			Hash:       tx.Hash(),</span>
<span class="term-fg32">+			Input:      hexutil.Bytes(tx.Data()),</span>
<span class="term-fg32">+			To:         tx.To(),</span>
<span class="term-fg32">+			Value:      (*hexutil.Big)(tx.Value()),</span>
<span class="term-fg32">+			Mint:       (*hexutil.Big)(tx.Mint()),</span>
<span class="term-fg32">+			SourceHash: &amp;srcHash,</span>
<span class="term-fg32">+			IsSystemTx: &amp;isSystemTx,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if blockHash != (common.Hash{}) {</span>
<span class="term-fg32">+			result.BlockHash = &amp;blockHash</span>
<span class="term-fg32">+			result.BlockNumber = (*hexutil.Big)(new(big.Int).SetUint64(blockNumber))</span>
<span class="term-fg32">+			result.TransactionIndex = (*hexutil.Uint64)(&amp;index)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return result</span>
<span class="term-fg32">+	}</span>
 	v, r, s := tx.RawSignatureValues()
 	result := &amp;RPCTransaction{
 		Type:     hexutil.Uint64(tx.Type()),
<span class="term-fg36">@@ -1636,6 +1681,12 @@</span> 		&quot;contractAddress&quot;:   nil,
 		&quot;logs&quot;:              receipt.Logs,
 		&quot;logsBloom&quot;:         receipt.Bloom,
 		&quot;type&quot;:              hexutil.Uint(tx.Type()),
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if s.b.ChainConfig().Optimism != nil &amp;&amp; !tx.IsDepositTx() {</span>
<span class="term-fg32">+		fields[&quot;l1GasPrice&quot;] = (*hexutil.Big)(receipt.L1GasPrice)</span>
<span class="term-fg32">+		fields[&quot;l1GasUsed&quot;] = (*hexutil.Big)(receipt.L1GasUsed)</span>
<span class="term-fg32">+		fields[&quot;l1Fee&quot;] = (*hexutil.Big)(receipt.L1Fee)</span>
<span class="term-fg32">+		fields[&quot;l1FeeScalar&quot;] = receipt.FeeScalar.String()</span>
 	}
 	&#47;&#47; Assign the effective gas price paid
 	if !s.b.ChainConfig().IsLondon(bigblock) {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-596fbd5e29283e9ba922ee17" role="button"
                   aria-expanded="false" aria-controls="id-596fbd5e29283e9ba922ee17">
                    <code>internal/ethapi/backend.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+2</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/internal/ethapi/backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/internal/ethapi/backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-596fbd5e29283e9ba922ee17"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;ethapi&#47;backend.go op-geth&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg1">index 5b4ceb6310691f4a32b3d18ac7e00b45a9c4c76f..355c8b896f228fdc0db8c6206e50a3aa2489b525 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg36">@@ -86,6 +86,8 @@</span> 	SubscribeNewTxsEvent(chan&lt;- core.NewTxsEvent) event.Subscription
&nbsp;
 	ChainConfig() *params.ChainConfig
 	Engine() consensus.Engine
<span class="term-fg32">+	HistoricalRPCService() *rpc.Client</span>
<span class="term-fg32">+	Genesis() *types.Block</span>
&nbsp;
 	&#47;&#47; eth&#47;filters needs to be initialized from this backend type, so methods needed by
 	&#47;&#47; it must also be included here.</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2b7fdb686d4eb9238633f986" role="button"
                   aria-expanded="false" aria-controls="id-2b7fdb686d4eb9238633f986">
                    <code>internal/ethapi/transaction_args_test.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+3</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/internal/ethapi/transaction_args_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/internal/ethapi/transaction_args_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2b7fdb686d4eb9238633f986"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;ethapi&#47;transaction_args_test.go op-geth&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg1">index 28dc561c36e4c73eafd42daa42cf66b7e534de87..ef6ba15d70f025c167a87a40549cf83ecdac3a89 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg36">@@ -339,4 +339,6 @@</span> func (b *backendMock) SubscribeRemovedLogsEvent(ch chan&lt;- core.RemovedLogsEvent) event.Subscription {
 	return nil
 }
&nbsp;
<span class="term-fg31">-func (b *backendMock) Engine() consensus.Engine { return nil }</span>
<span class="term-fg32">+func (b *backendMock) Engine() consensus.Engine          { return nil }</span>
<span class="term-fg32">+func (b *backendMock) HistoricalRPCService() *rpc.Client { return nil }</span>
<span class="term-fg32">+func (b *backendMock) Genesis() *types.Block             { return nil }</span></div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c6ae39a508355f74926faafa" role="button"
                   aria-expanded="false" aria-controls="id-c6ae39a508355f74926faafa">
                    <code>internal/flags/categories.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/internal/flags/categories.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/internal/flags/categories.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c6ae39a508355f74926faafa"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;flags&#47;categories.go op-geth&#47;internal&#47;flags&#47;categories.go</span>
<span class="term-fg1">index c2db6c6c1d25c115c77c8a829d481133a932faa7..f2b368775867174abef2e16d6c64d10b890ca9ff 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;flags&#47;categories.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;flags&#47;categories.go</span>
<span class="term-fg36">@@ -31,6 +31,7 @@</span> 	NetworkingCategory = &quot;NETWORKING&quot;
 	MinerCategory      = &quot;MINER&quot;
 	GasPriceCategory   = &quot;GAS PRICE ORACLE&quot;
 	VMCategory         = &quot;VIRTUAL MACHINE&quot;
<span class="term-fg32">+	RollupCategory     = &quot;ROLLUP NODE&quot;</span>
 	LoggingCategory    = &quot;LOGGING AND DEBUGGING&quot;
 	MetricsCategory    = &quot;METRICS AND STATS&quot;
 	MiscCategory       = &quot;MISC&quot;</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7eb19c83ab1e56ce44ea6628" role="button"
                   aria-expanded="false" aria-controls="id-7eb19c83ab1e56ce44ea6628">
                    <code>les/api_backend.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+9</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/les/api_backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/les/api_backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7eb19c83ab1e56ce44ea6628"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;api_backend.go op-geth&#47;les&#47;api_backend.go</span>
<span class="term-fg1">index 71cfbbed1e55d6484a40e162d330e2557e44a37c..f56d2102cea85e3fd0d284a43a7d3a92ddf5aa0a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;api_backend.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;api_backend.go</span>
<span class="term-fg36">@@ -186,6 +186,7 @@</span> 		vmConfig = new(vm.Config)
 	}
 	txContext := core.NewEVMTxContext(msg)
 	context := core.NewEVMBlockContext(header, b.eth.blockchain, nil)
<span class="term-fg32">+	context.L1CostFunc = types.NewL1CostFunc(b.eth.chainConfig, state)</span>
 	return vm.NewEVM(context, txContext, state, b.eth.chainConfig, *vmConfig), state.Error, nil
 }
&nbsp;
<span class="term-fg36">@@ -329,3 +330,11 @@</span>
 func (b *LesApiBackend) StateAtTransaction(ctx context.Context, block *types.Block, txIndex int, reexec uint64) (core.Message, vm.BlockContext, *state.StateDB, tracers.StateReleaseFunc, error) {
 	return b.eth.stateAtTransaction(ctx, block, txIndex, reexec)
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *LesApiBackend) HistoricalRPCService() *rpc.Client {</span>
<span class="term-fg32">+	return b.eth.historicalRPCService</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *LesApiBackend) Genesis() *types.Block {</span>
<span class="term-fg32">+	return b.eth.blockchain.Genesis()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bde61bac6b343796a67ac0ba" role="button"
                   aria-expanded="false" aria-controls="id-bde61bac6b343796a67ac0ba">
                    <code>les/client.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+24</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/les/client.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/les/client.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bde61bac6b343796a67ac0ba"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;client.go op-geth&#47;les&#47;client.go</span>
<span class="term-fg1">index c304bf86f8a8305d719d5009ad09da56b5b0d361..0c5df65aadf4e949cd8ce55bcbb6da163064e91a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;client.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;client.go</span>
<span class="term-fg36">@@ -18,6 +18,7 @@</span> &#47;&#47; Package les implements the Light Ethereum Subprotocol.
 package les
&nbsp;
 import (
<span class="term-fg32">+	&quot;context&quot;</span>
 	&quot;fmt&quot;
 	&quot;strings&quot;
 	&quot;time&quot;
<span class="term-fg36">@@ -65,6 +66,9 @@</span> 	serverPool         *vfc.ServerPool
 	serverPoolIterator enode.Iterator
 	pruner             *pruner
 	merger             *consensus.Merger
<span class="term-fg32">+</span>
<span class="term-fg32">+	seqRPCService        *rpc.Client</span>
<span class="term-fg32">+	historicalRPCService *rpc.Client</span>
&nbsp;
 	bloomRequests chan chan *bloombits.Retrieval &#47;&#47; Channel receiving bloom data retrieval requests
 	bloomIndexer  *core.ChainIndexer             &#47;&#47; Bloom indexer operating during block imports
<span class="term-fg36">@@ -193,6 +197,26 @@</span> 	leth.handler = newClientHandler(config.UltraLightServers, config.UltraLightFraction, checkpoint, leth)
 	if leth.handler.ulc != nil {
 		log.Warn(&quot;Ultra light client is enabled&quot;, &quot;trustedNodes&quot;, len(leth.handler.ulc.keys), &quot;minTrustedFraction&quot;, leth.handler.ulc.fraction)
 		leth.blockchain.DisableCheckFreq()
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if config.RollupSequencerHTTP != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupSequencerHTTP)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		leth.seqRPCService = client</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if config.RollupHistoricalRPC != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupHistoricalRPC)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		leth.historicalRPCService = client</span>
 	}
&nbsp;
 	leth.netRPCService = ethapi.NewNetAPI(leth.p2pServer, leth.config.NetworkId)</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-67e0883f908eef59d78f0bd8" role="button"
                   aria-expanded="false" aria-controls="id-67e0883f908eef59d78f0bd8">
                    <code>les/state_accessor.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/les/state_accessor.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/les/state_accessor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-67e0883f908eef59d78f0bd8"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;state_accessor.go op-geth&#47;les&#47;state_accessor.go</span>
<span class="term-fg1">index a2d49fbf31ce080d49242517bbebfa4f5f7676b5..d3490a4b18d183b1df17223052204b4b4e114439 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;state_accessor.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;state_accessor.go</span>
<span class="term-fg36">@@ -67,6 +67,7 @@</span> 		statedb.Prepare(tx.Hash(), idx)
 		if idx == txIndex {
 			return msg, context, statedb, release, nil
 		}
<span class="term-fg32">+		context.L1CostFunc = types.NewL1CostFunc(leth.blockchain.Config(), statedb)</span>
 		&#47;&#47; Not yet the searched for transaction, execute on top of the current state
 		vmenv := vm.NewEVM(context, txContext, statedb, leth.blockchain.Config(), vm.Config{})
 		if _, err := core.ApplyMessage(vmenv, msg, new(core.GasPool).AddGas(tx.Gas())); err != nil {</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9fed6bcb022d6be9f5141702" role="button"
                   aria-expanded="false" aria-controls="id-9fed6bcb022d6be9f5141702">
                    <code>miner/miner.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+5</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/miner/miner.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/miner/miner.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9fed6bcb022d6be9f5141702"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;miner.go op-geth&#47;miner&#47;miner.go</span>
<span class="term-fg1">index 5102cb523c396bb824b0e1869b915f6ce84c723d..f93b78c8ce680f27a1ec268d04e48bf13ac10f1b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;miner.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;miner.go</span>
<span class="term-fg36">@@ -31,6 +31,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;txpool&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;downloader&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg36">@@ -41,6 +42,10 @@</span> &#47;&#47; to offer all the functions here.
 type Backend interface {
 	BlockChain() *core.BlockChain
 	TxPool() *txpool.TxPool
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type BackendWithHistoricalState interface {</span>
<span class="term-fg32">+	StateAtBlock(block *types.Block, reexec uint64, base *state.StateDB, readOnly bool, preferDisk bool) (statedb *state.StateDB, release tracers.StateReleaseFunc, err error)</span>
 }
&nbsp;
 &#47;&#47; Config is the configuration parameters of mining.</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-99bc5367a8cf5f2023017e27" role="button"
                   aria-expanded="false" aria-controls="id-99bc5367a8cf5f2023017e27">
                    <code>miner/payload_building.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+9</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/miner/payload_building.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/miner/payload_building.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-99bc5367a8cf5f2023017e27"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;payload_building.go op-geth&#47;miner&#47;payload_building.go</span>
<span class="term-fg1">index cdea6a3cc368d6bd861279c6764433239cfadd31..0d50dd3f989b8723c5c81a0b2c1b30332b01c516 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;payload_building.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;payload_building.go</span>
<span class="term-fg36">@@ -36,6 +36,10 @@</span> 	Parent       common.Hash    &#47;&#47; The parent block to build payload on top
 	Timestamp    uint64         &#47;&#47; The provided timestamp of generated payload
 	FeeRecipient common.Address &#47;&#47; The provided recipient address for collecting transaction fee
 	Random       common.Hash    &#47;&#47; The provided randomness value
<span class="term-fg32">+</span>
<span class="term-fg32">+	NoTxPool     bool                 &#47;&#47; Optimism addition: option to disable tx pool contents from being included</span>
<span class="term-fg32">+	Transactions []*types.Transaction &#47;&#47; Optimism addition: txs forced into the block via engine API</span>
<span class="term-fg32">+	GasLimit     *uint64              &#47;&#47; Optimism addition: override gas limit of the block to build</span>
 }
&nbsp;
 &#47;&#47; Payload wraps the built payload(block waiting for sealing). According to the
<span class="term-fg36">@@ -134,12 +138,15 @@</span> func (w *worker) buildPayload(args *BuildPayloadArgs) (*Payload, error) {
 	&#47;&#47; Build the initial version with no transaction included. It should be fast
 	&#47;&#47; enough to run. The empty payload can at least make sure there is something
 	&#47;&#47; to deliver for not missing slot.
<span class="term-fg31">-	empty, _, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, true)</span>
<span class="term-fg32">+	empty, _, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, true, args.Transactions, args.GasLimit)</span>
 	if err != nil {
 		return nil, err
 	}
 	&#47;&#47; Construct a payload object for return.
 	payload := newPayload(empty)
<span class="term-fg32">+	if args.NoTxPool { &#47;&#47; don&#39;t start the background payload updating job if there is no tx pool to pull from</span>
<span class="term-fg32">+		return payload, nil</span>
<span class="term-fg32">+	}</span>
&nbsp;
 	&#47;&#47; Spin up a routine for updating the payload in background. This strategy
 	&#47;&#47; can maximum the revenue for including transactions with highest fee.
<span class="term-fg36">@@ -158,7 +165,7 @@</span> 		for {
 			select {
 			case &lt;-timer.C:
 				start := time.Now()
<span class="term-fg31">-				block, fees, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, false)</span>
<span class="term-fg32">+				block, fees, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, false, args.Transactions, args.GasLimit)</span>
 				if err == nil {
 					payload.update(block, fees, time.Since(start))
 				}</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dd79bccdf66c1c3366887499" role="button"
                   aria-expanded="false" aria-controls="id-dd79bccdf66c1c3366887499">
                    <code>miner/worker.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+36</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/miner/worker.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/miner/worker.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dd79bccdf66c1c3366887499"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;worker.go op-geth&#47;miner&#47;worker.go</span>
<span class="term-fg1">index b38d68e7ea0caee556e55221c90daf878b4f39cd..6334765397fe0e2727e6e0d1307af253c929e012 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;worker.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;worker.go</span>
<span class="term-fg36">@@ -25,12 +25,14 @@</span> 	&quot;sync&#47;atomic&quot;
 	&quot;time&quot;
&nbsp;
 	mapset &quot;github.com&#47;deckarep&#47;golang-set&quot;
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;misc&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg36">@@ -785,6 +787,14 @@</span> func (w *worker) makeEnv(parent *types.Block, header *types.Header, coinbase common.Address) (*environment, error) {
 	&#47;&#47; Retrieve the parent state to execute on top and start a prefetcher for
 	&#47;&#47; the miner to speed block sealing up a bit.
 	state, err := w.chain.StateAt(parent.Root())
<span class="term-fg32">+	if err != nil &amp;&amp; w.chainConfig.Optimism != nil { &#47;&#47; Allow the miner to reorg its own chain arbitrarily deep</span>
<span class="term-fg32">+		if historicalBackend, ok := w.eth.(BackendWithHistoricalState); ok {</span>
<span class="term-fg32">+			var release tracers.StateReleaseFunc</span>
<span class="term-fg32">+			state, release, err = historicalBackend.StateAtBlock(parent, ^uint64(0), nil, false, false)</span>
<span class="term-fg32">+			state = state.Copy()</span>
<span class="term-fg32">+			release()</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -967,6 +977,9 @@</span> 	random     common.Hash    &#47;&#47; The randomness generated by beacon chain, empty before the merge
 	noUncle    bool           &#47;&#47; Flag whether the uncle block inclusion is allowed
 	noExtra    bool           &#47;&#47; Flag whether the extra field assignment is allowed
 	noTxs      bool           &#47;&#47; Flag whether an empty block without any transaction is expected
<span class="term-fg32">+</span>
<span class="term-fg32">+	txs      types.Transactions &#47;&#47; Deposit transactions to include at the start of the block</span>
<span class="term-fg32">+	gasLimit *uint64            &#47;&#47; Optional gas limit override</span>
 }
&nbsp;
 &#47;&#47; prepareWork constructs the sealing task according to the given parameters,
<span class="term-fg36">@@ -1016,6 +1029,9 @@</span> 		if !w.chainConfig.IsLondon(parent.Number()) {
 			parentGasLimit := parent.GasLimit() * w.chainConfig.ElasticityMultiplier()
 			header.GasLimit = core.CalcGasLimit(parentGasLimit, w.config.GasCeil)
 		}
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if genParams.gasLimit != nil { &#47;&#47; override gas limit if specified</span>
<span class="term-fg32">+		header.GasLimit = *genParams.gasLimit</span>
 	}
 	&#47;&#47; Run the consensus preparation with the default or customized consensus engine.
 	if err := w.engine.Prepare(w.chain, header); err != nil {
<span class="term-fg36">@@ -1081,14 +1097,28 @@</span> 	return nil
 }
&nbsp;
 &#47;&#47; generateWork generates a sealing block based on the given parameters.
<span class="term-fg31">-func (w *worker) generateWork(params *generateParams) (*types.Block, *big.Int, error) {</span>
<span class="term-fg31">-	work, err := w.prepareWork(params)</span>
<span class="term-fg32">+func (w *worker) generateWork(genParams *generateParams) (*types.Block, *big.Int, error) {</span>
<span class="term-fg32">+	work, err := w.prepareWork(genParams)</span>
 	if err != nil {
 		return nil, nil, err
 	}
 	defer work.discard()
<span class="term-fg32">+	if work.gasPool == nil {</span>
<span class="term-fg32">+		work.gasPool = new(core.GasPool).AddGas(work.header.GasLimit)</span>
<span class="term-fg32">+	}</span>
&nbsp;
<span class="term-fg31">-	if !params.noTxs {</span>
<span class="term-fg32">+	for _, tx := range genParams.txs {</span>
<span class="term-fg32">+		from, _ := types.Sender(work.signer, tx)</span>
<span class="term-fg32">+		work.state.Prepare(tx.Hash(), work.tcount)</span>
<span class="term-fg32">+		_, err := w.commitTransaction(work, tx)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, nil, fmt.Errorf(&quot;failed to force-include tx: %s type: %d sender: %s nonce: %d, err: %w&quot;, tx.Hash(), tx.Type(), from, tx.Nonce(), err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		work.tcount++</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; forced transactions done, fill rest of block with transactions</span>
<span class="term-fg32">+	if !genParams.noTxs {</span>
 		interrupt := new(int32)
 		timer := time.AfterFunc(w.newpayloadTimeout, func() {
 			atomic.StoreInt32(interrupt, commitInterruptTimeout)
<span class="term-fg36">@@ -1216,7 +1246,7 @@</span>
 &#47;&#47; getSealingBlock generates the sealing block based on the given parameters.
 &#47;&#47; The generation result will be passed back via the given channel no matter
 &#47;&#47; the generation itself succeeds or not.
<span class="term-fg31">-func (w *worker) getSealingBlock(parent common.Hash, timestamp uint64, coinbase common.Address, random common.Hash, noTxs bool) (*types.Block, *big.Int, error) {</span>
<span class="term-fg32">+func (w *worker) getSealingBlock(parent common.Hash, timestamp uint64, coinbase common.Address, random common.Hash, noTxs bool, transactions types.Transactions, gasLimit *uint64) (*types.Block, *big.Int, error) {</span>
 	req := &amp;getWorkReq{
 		params: &amp;generateParams{
 			timestamp:  timestamp,
<span class="term-fg36">@@ -1227,6 +1257,8 @@</span> 			random:     random,
 			noUncle:    true,
 			noExtra:    true,
 			noTxs:      noTxs,
<span class="term-fg32">+			txs:        transactions,</span>
<span class="term-fg32">+			gasLimit:   gasLimit,</span>
 		},
 		result: make(chan *newPayloadResult, 1),
 	}</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-431cdabab9e7c847a8d554c4" role="button"
                   aria-expanded="false" aria-controls="id-431cdabab9e7c847a8d554c4">
                    <code>miner/worker_test.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+2</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/miner/worker_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/miner/worker_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-431cdabab9e7c847a8d554c4"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;worker_test.go op-geth&#47;miner&#47;worker_test.go</span>
<span class="term-fg1">index 859495d7bf1692701fbd17ec9c07c08b37bfa64c..d69c02523d16e3f3018ef6318c9a813e319b59d4 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;worker_test.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;worker_test.go</span>
<span class="term-fg36">@@ -637,7 +637,7 @@</span> 	}
&nbsp;
 	&#47;&#47; This API should work even when the automatic sealing is not enabled
 	for _, c := range cases {
<span class="term-fg31">-		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, false)</span>
<span class="term-fg32">+		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, false, nil, nil)</span>
 		if c.expectErr {
 			if err == nil {
 				t.Error(&quot;Expect error but get nil&quot;)
<span class="term-fg36">@@ -653,7 +653,7 @@</span>
 	&#47;&#47; This API should work even when the automatic sealing is enabled
 	w.start()
 	for _, c := range cases {
<span class="term-fg31">-		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, false)</span>
<span class="term-fg32">+		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, false, nil, nil)</span>
 		if c.expectErr {
 			if err == nil {
 				t.Error(&quot;Expect error but get nil&quot;)</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-58dc99fb60ddf9ca0d92635a" role="button"
                   aria-expanded="false" aria-controls="id-58dc99fb60ddf9ca0d92635a">
                    <code>params/config.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+28</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/params/config.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/params/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-58dc99fb60ddf9ca0d92635a"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;config.go op-geth&#47;params&#47;config.go</span>
<span class="term-fg1">index e3e48f9c259709f780424d03c0d6b0674e0e0948..5d90db6572f3c73275c5d71d7fc418ad9f85cca7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;config.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;config.go</span>
<span class="term-fg36">@@ -21,8 +21,9 @@</span> 	&quot;encoding&#47;binary&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
&nbsp;
<span class="term-fg32">+	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg31">-	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;</span>
 )
&nbsp;
 &#47;&#47; Genesis hashes to enforce below configs on.
<span class="term-fg36">@@ -270,17 +271,17 @@</span> 	&#47;&#47; and accepted by the Ethereum core developers into the Ethash consensus.
 	&#47;&#47;
 	&#47;&#47; This configuration is intentionally not using keyed fields to force anyone
 	&#47;&#47; adding flags to the config to also have to set these fields.
<span class="term-fg31">-	AllEthashProtocolChanges = &amp;ChainConfig{big.NewInt(1337), big.NewInt(0), nil, false, big.NewInt(0), common.Hash{}, big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), nil, nil, nil, nil, false, new(EthashConfig), nil}</span>
<span class="term-fg32">+	AllEthashProtocolChanges = &amp;ChainConfig{big.NewInt(1337), big.NewInt(0), nil, false, big.NewInt(0), common.Hash{}, big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), nil, nil, nil, nil, false, new(EthashConfig), nil, nil}</span>
&nbsp;
 	&#47;&#47; AllCliqueProtocolChanges contains every protocol change (EIPs) introduced
 	&#47;&#47; and accepted by the Ethereum core developers into the Clique consensus.
 	&#47;&#47;
 	&#47;&#47; This configuration is intentionally not using keyed fields to force anyone
 	&#47;&#47; adding flags to the config to also have to set these fields.
<span class="term-fg31">-	AllCliqueProtocolChanges = &amp;ChainConfig{big.NewInt(1337), big.NewInt(0), nil, false, big.NewInt(0), common.Hash{}, big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), nil, nil, nil, nil, nil, nil, false, nil, &amp;CliqueConfig{Period: 0, Epoch: 30000}}</span>
<span class="term-fg32">+	AllCliqueProtocolChanges = &amp;ChainConfig{big.NewInt(1337), big.NewInt(0), nil, false, big.NewInt(0), common.Hash{}, big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), nil, nil, nil, nil, nil, nil, false, nil, &amp;CliqueConfig{Period: 0, Epoch: 30000}, nil}</span>
&nbsp;
<span class="term-fg31">-	TestChainConfig    = &amp;ChainConfig{big.NewInt(1), big.NewInt(0), nil, false, big.NewInt(0), common.Hash{}, big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), nil, nil, nil, nil, false, new(EthashConfig), nil}</span>
<span class="term-fg31">-	NonActivatedConfig = &amp;ChainConfig{big.NewInt(1), nil, nil, false, nil, common.Hash{}, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, false, new(EthashConfig), nil}</span>
<span class="term-fg32">+	TestChainConfig    = &amp;ChainConfig{big.NewInt(1), big.NewInt(0), nil, false, big.NewInt(0), common.Hash{}, big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), big.NewInt(0), nil, nil, nil, nil, false, new(EthashConfig), nil, nil}</span>
<span class="term-fg32">+	NonActivatedConfig = &amp;ChainConfig{big.NewInt(1), nil, nil, false, nil, common.Hash{}, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, false, new(EthashConfig), nil, nil}</span>
 	TestRules          = TestChainConfig.Rules(new(big.Int), false)
 )
&nbsp;
<span class="term-fg36">@@ -386,6 +387,9 @@</span>
 	&#47;&#47; Various consensus engines
 	Ethash *EthashConfig `json:&quot;ethash,omitempty&quot;`
 	Clique *CliqueConfig `json:&quot;clique,omitempty&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Optimism config, nil if not active</span>
<span class="term-fg32">+	Optimism *OptimismConfig `json:&quot;optimism,omitempty&quot;`</span>
 }
&nbsp;
 &#47;&#47; EthashConfig is the consensus engine configs for proof-of-work based sealing.
<span class="term-fg36">@@ -407,6 +411,17 @@</span> func (c *CliqueConfig) String() string {
 	return &quot;clique&quot;
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; OptimismConfig is the optimism config.</span>
<span class="term-fg32">+type OptimismConfig struct {</span>
<span class="term-fg32">+	EIP1559Elasticity  uint64 `json:&quot;eip1559Elasticity&quot;`</span>
<span class="term-fg32">+	EIP1559Denominator uint64 `json:&quot;eip1559Denominator&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; String implements the stringer interface, returning the optimism fee config details.</span>
<span class="term-fg32">+func (o *OptimismConfig) String() string {</span>
<span class="term-fg32">+	return &quot;optimism&quot;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; Description returns a human-readable description of ChainConfig.
 func (c *ChainConfig) Description() string {
 	var banner string
<span class="term-fg36">@@ -434,6 +449,8 @@</span> 			banner += &quot;Consensus: Beacon (proof-of-stake), merging from Clique (proof-of-authority)\n&quot;
 		} else {
 			banner += &quot;Consensus: Beacon (proof-of-stake), merged from Clique (proof-of-authority)\n&quot;
 		}
<span class="term-fg32">+	case c.Optimism != nil:</span>
<span class="term-fg32">+		banner += &quot;Consensus: Optimism\n&quot;</span>
 	default:
 		banner += &quot;Consensus: unknown\n&quot;
 	}
<span class="term-fg36">@@ -711,11 +728,17 @@</span> }
&nbsp;
 &#47;&#47; BaseFeeChangeDenominator bounds the amount the base fee can change between blocks.
 func (c *ChainConfig) BaseFeeChangeDenominator() uint64 {
<span class="term-fg32">+	if c.Optimism != nil {</span>
<span class="term-fg32">+		return c.Optimism.EIP1559Denominator</span>
<span class="term-fg32">+	}</span>
 	return DefaultBaseFeeChangeDenominator
 }
&nbsp;
 &#47;&#47; ElasticityMultiplier bounds the maximum gas limit an EIP-1559 block may have.
 func (c *ChainConfig) ElasticityMultiplier() uint64 {
<span class="term-fg32">+	if c.Optimism != nil {</span>
<span class="term-fg32">+		return c.Optimism.EIP1559Elasticity</span>
<span class="term-fg32">+	}</span>
 	return DefaultElasticityMultiplier
 }
</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-70534435ea8d65f644a3082e" role="button"
                   aria-expanded="false" aria-controls="id-70534435ea8d65f644a3082e">
                    <code>params/protocol_params.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+12</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/params/protocol_params.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/params/protocol_params.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-70534435ea8d65f644a3082e"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;protocol_params.go op-geth&#47;params&#47;protocol_params.go</span>
<span class="term-fg1">index b0037fd471c4684454bcdb873636368b649f399a..00ecd554205308fd785ffc65c61061b3a897e7cb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;protocol_params.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;protocol_params.go</span>
<span class="term-fg36">@@ -16,7 +16,18 @@</span> &#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.
&nbsp;
 package params
&nbsp;
<span class="term-fg31">-import &quot;math&#47;big&quot;</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	&#47;&#47; The base fee portion of the transaction fee accumulates at this predeploy</span>
<span class="term-fg32">+	OptimismBaseFeeRecipient = common.HexToAddress(&quot;0x4200000000000000000000000000000000000019&quot;)</span>
<span class="term-fg32">+	&#47;&#47; The L1 portion of the transaction fee accumulates at this predeploy</span>
<span class="term-fg32">+	OptimismL1FeeRecipient = common.HexToAddress(&quot;0x420000000000000000000000000000000000001A&quot;)</span>
<span class="term-fg32">+)</span>
&nbsp;
 const (
 	GasLimitBoundDivisor uint64 = 1024               &#47;&#47; The bound divisor of the gas limit, used in update calculations.</div>
    </div>

            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-df861a516f185a4b3b4e4539" role="button"
                   aria-expanded="false" aria-controls="id-df861a516f185a4b3b4e4539">
                    <code>params/version.go</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+25</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/params/version.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/params/version.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-df861a516f185a4b3b4e4539"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;version.go op-geth&#47;params&#47;version.go</span>
<span class="term-fg1">index 3172415393257c51552558e73beabb5f1e096903..f568b46f6ce906c542a84320ed6468c5cd2f4840 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;version.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;version.go</span>
<span class="term-fg36">@@ -21,20 +21,41 @@</span> 	&quot;fmt&quot;
 )
&nbsp;
 const (
<span class="term-fg32">+	&#47;&#47; Version is the version of upstream geth</span>
 	VersionMajor = 1          &#47;&#47; Major version component of the current release
 	VersionMinor = 11         &#47;&#47; Minor version component of the current release
 	VersionPatch = 0          &#47;&#47; Patch version component of the current release
 	VersionMeta  = &quot;unstable&quot; &#47;&#47; Version metadata to append to the version string
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; OPVersion is the version of op-geth</span>
<span class="term-fg32">+	OPVersionMajor = 0          &#47;&#47; Major version component of the current release</span>
<span class="term-fg32">+	OPVersionMinor = 1          &#47;&#47; Minor version component of the current release</span>
<span class="term-fg32">+	OPVersionPatch = 0          &#47;&#47; Patch version component of the current release</span>
<span class="term-fg32">+	OPVersionMeta  = &quot;unstable&quot; &#47;&#47; Version metadata to append to the version string</span>
 )
&nbsp;
 &#47;&#47; Version holds the textual version string.
 var Version = func() string {
<span class="term-fg31">-	return fmt.Sprintf(&quot;%d.%d.%d&quot;, VersionMajor, VersionMinor, VersionPatch)</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;%d.%d.%d&quot;, OPVersionMajor, OPVersionMinor, OPVersionPatch)</span>
 }()
&nbsp;
 &#47;&#47; VersionWithMeta holds the textual version string including the metadata.
 var VersionWithMeta = func() string {
 	v := Version
<span class="term-fg32">+	if OPVersionMeta != &quot;&quot; {</span>
<span class="term-fg32">+		v += &quot;-&quot; + OPVersionMeta</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return v</span>
<span class="term-fg32">+}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GethVersion holds the textual geth version string.</span>
<span class="term-fg32">+var GethVersion = func() string {</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;%d.%d.%d&quot;, VersionMajor, VersionMinor, VersionPatch)</span>
<span class="term-fg32">+}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GethVersionWithMeta holds the textual geth version string including the metadata.</span>
<span class="term-fg32">+var GethVersionWithMeta = func() string {</span>
<span class="term-fg32">+	v := GethVersion</span>
 	if VersionMeta != &quot;&quot; {
 		v += &quot;-&quot; + VersionMeta
 	}
<span class="term-fg36">@@ -46,8 +67,8 @@</span> &#47;&#47; &quot;1.8.11-dea1ce05&quot; for stable releases, or &quot;1.8.13-unstable-21c059b6&quot; for unstable
 &#47;&#47; releases.
 func ArchiveVersion(gitCommit string) string {
 	vsn := Version
<span class="term-fg31">-	if VersionMeta != &quot;stable&quot; {</span>
<span class="term-fg31">-		vsn += &quot;-&quot; + VersionMeta</span>
<span class="term-fg32">+	if OPVersionMeta != &quot;stable&quot; {</span>
<span class="term-fg32">+		vsn += &quot;-&quot; + OPVersionMeta</span>
 	}
 	if len(gitCommit) &gt;= 8 {
 		vsn += &quot;-&quot; + gitCommit[:8]
<span class="term-fg36">@@ -60,7 +81,7 @@</span> 	vsn := VersionWithMeta
 	if len(gitCommit) &gt;= 8 {
 		vsn += &quot;-&quot; + gitCommit[:8]
 	}
<span class="term-fg31">-	if (VersionMeta != &quot;stable&quot;) &amp;&amp; (gitDate != &quot;&quot;) {</span>
<span class="term-fg32">+	if (OPVersionMeta != &quot;stable&quot;) &amp;&amp; (gitDate != &quot;&quot;) {</span>
 		vsn += &quot;-&quot; + gitDate
 	}
 	return vsn</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="text-muted">
                    <div>
    <div class="row">
        
            <div class="col-8 col-md-4  text-start"><h4>Ignored changes</h4></div>
        
        <div class="col-2 text-end mt-2"><span class="text-success">+1</span></div>
        <div class="col-2 text-start mt-2"><span class="text-danger">-0</span></div>
    </div>
    <div class="row forkdef-content my-3">
        <div></div>
        <div>
            
                <div class="container-fluid border-bottom"><div class="row">
            <div class="col-8 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bec489d1a0abe4e507142446" role="button"
                   aria-expanded="false" aria-controls="id-bec489d1a0abe4e507142446">
                    <code>go.sum</code>
                </a>
            </div>

            <div class="col-4 col-md-4 px-2">
                
                    <div class="row">
                        <div class="col-6 text-end"><span class="text-success">+1</span></div>
                        <div class="col-6 text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>

            <div class="col col-md-4 text-end ps-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/6d55908347cac7463dd6a2cb236f30ec26c9a121/go.sum" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/30db39cae2be40252eff70b38e8ae927b377d6bd/go.sum" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bec489d1a0abe4e507142446"><span class="term-fg1">diff --git go-ethereum&#47;go.sum op-geth&#47;go.sum</span>
<span class="term-fg1">index 50c27386cbaeabfd9a9d2e1bf6dbc1def49f6c12..91ba28e7743cffc547f297e350811cf2861d5711 100644</span>
<span class="term-fg1">--- go-ethereum&#47;go.sum</span>
<span class="term-fg1">+++ op-geth&#47;go.sum</span>
<span class="term-fg36">@@ -554,6 +554,7 @@</span> golang.org&#47;x&#47;sys v0.0.0-20210615035016-665e8c7367d1&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
 golang.org&#47;x&#47;sys v0.0.0-20211019181941-9d821ace8654&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
 golang.org&#47;x&#47;sys v0.0.0-20211020174200-9d6173849985&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
 golang.org&#47;x&#47;sys v0.0.0-20220517195934-5e4e11fc645e&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
<span class="term-fg32">+golang.org&#47;x&#47;sys v0.0.0-20220520151302-bc2c85ada10a h1:dGzPydgVsqGcTRVwiLJ1jVbufYwmzD3LfVPLKsKg+0k=</span>
 golang.org&#47;x&#47;sys v0.0.0-20220520151302-bc2c85ada10a&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
 golang.org&#47;x&#47;sys v0.0.0-20221013171732-95e765b1cc43 h1:OK7RB6t2WQX54srQQYSXMW8dF5C6&#47;8+oA&#47;s5QBmmto4=
 golang.org&#47;x&#47;sys v0.0.0-20221013171732-95e765b1cc43&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

                </div>
            
        </main>
    </div>

    <footer class="col-xl-10 col-xxl-8 mx-auto px-3 pt-5 my-5 text-muted border-top">
        <p>Op-geth is awesome</p>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
</body>
</html>
